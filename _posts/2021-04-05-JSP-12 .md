---
layout: post
title: "JSP - NewLecture - GET/POST í•©ì¹˜ê¸°(ê³„ì‚°ê¸° í”„ë¡œê·¸ë¨), MVC model1, MVC model2, ELê°ì²´ "
date: 2021-04-05
category : [JSP]
comments: true
---

## ğŸ”· NewLecture - GET/POST í•©ì¹˜ê¸°, MVC model1, MVC model2, ELê°ì²´

### âœ” GET/POST í•©ì¹˜ê¸°(ê³„ì‚°ê¸° í”„ë¡œê·¸ë¨)

- ì½”ë“œ
    ```java
    package newlecture;

    import java.io.IOException;
    import java.io.PrintWriter;

    import javax.script.ScriptEngine;
    import javax.script.ScriptEngineManager;
    import javax.script.ScriptException;
    import javax.servlet.ServletException;
    import javax.servlet.annotation.WebServlet;
    import javax.servlet.http.Cookie;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    // get,post í•©ì¹˜ê¸°
    @WebServlet("/calculator")
    public class calculator extends HttpServlet {
        
        @Override
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            //ì¿ í‚¤ ë°°ì—´ë³€ìˆ˜ ì„ ì–¸
                    Cookie[] cookies = request.getCookies();	
                            
            // ì¿ í‚¤ ì½ì–´ì˜¤ëŠ” ì—°ì‚°ì‹
            String exp="0";	
            if(cookies !=null) { // ì¿ í‚¤ê°€ nullì´ ì•„ë‹ê²½ìš°
                for(Cookie c : cookies) { // ì—°ì‚°ì‹ ì‹¤í–‰
                    if(c.getName().equals("exp")) {
                        exp =c.getValue();
                        break;
                        }
                    }
            }                    

            response.setCharacterEncoding("UTF-8");
            response.setContentType("text/html; charset=UTF-8");
            PrintWriter out = response.getWriter();

            // ë™ì ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤
            out.write("<!DOCTYPE html>");
            out.write("<html>");
            out.write("<head>");
            out.write("<meta charset=\"UTF-8\"> ");
            out.write("<title>calc</title>");
            out.write("<style>");
            out.write("input{");
            out.write("	width : 50px;");
            out.write("	height : 50px;");
            out.write("}");
            out.write(".output{");
            out.write("height : 50px;");
            out.write("background : #e9e9e9;");
            out.write("font-size:24px;");
            out.write("font-weight : bold;");
            out.write("text-align : right;");
            out.write("padding : 0px, 5px;");
            out.write("}");
            out.write("</style>");
            out.write("</head>");
            out.write("<body>");
            out.write("<form method=\"post\">");
            out.write("<table>");
            out.write("<tr>");
            out.printf(		"<td class=\"output\" colspan=\"4\">%s</td>",exp); // exp ì¶œë ¥
            out.write("</tr>");
            out.write("<tr>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"CE\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"C\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"BS\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"/\" /></td>");
            out.write("</tr>");
            out.write("<tr>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"7\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"8\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"9\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"*\" /></td>");
            out.write("</tr>");
            out.write("<tr>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"4\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"5\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"6\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"-\" /></td>");
            out.write("</tr>");
            out.write("<tr>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"1\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"2\" /></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"3\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"+\" /></td>");
            out.write("</tr>");
            out.write("<tr>");
            out.write("<td></td>");
            out.write("<td><input type=\"submit\" name=\"value\" value=\"0\" /></td>");
            out.write("<td><input type=\"submit\" name=\"dot\" value=\".\" /></td>");
            out.write("<td><input type=\"submit\" name=\"operator\" value=\"=\" /></td>");
            out.write("</tr>");
            out.write("</table>");
            out.write("</form>");
            out.write("</body>");
            out.write("</html>");
        }
        @Override
        protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            //ì¿ í‚¤ ë°°ì—´ë³€ìˆ˜ ì„ ì–¸
            Cookie[] cookies = request.getCookies();	
            
            // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì„ ê°€ì§€ê³ 
            String value = request.getParameter("value");
            String operator = request.getParameter("operator");
            String dot = request.getParameter("dot");
            
            // ì¿ í‚¤ë¥¼ ë§Œë“¤ì–´ expë¡œ ì „ë‹¬í•œë‹¤
            String exp ="";
            // ì¿ í‚¤ ì½ì–´ì˜¤ëŠ”ì—°ì‚°ì‹
            if(cookies !=null) { // ì¿ í‚¤ê°€ nullì´ ì•„ë‹ê²½ìš°
                for(Cookie c : cookies) { // ì—°ì‚°ì‹ ì‹¤í–‰
                    if(c.getName().equals("exp")) {
                        exp =c.getValue();
                        break;
                        }
                    }
            }
            if(operator !=null && operator.equals("=")) {
                
                // ê³„ì‚°
                // javaScript êµ¬ë¬¸ ì‹¤í–‰ ê°ì²´ ìƒì„±
                ScriptEngine engine = new ScriptEngineManager().getEngineByName("nashorn");
                try {
                    exp = String.valueOf(engine.eval(exp));
                } catch (ScriptException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }
            }else if(operator !=null && operator.equals("C")) { // ì¿ í‚¤ ì‚­ì œ : Cë²„íŠ¼í´ë¦­ ì‹œ ì´ˆê¸°í™”
                exp = "";
            }
            else {
                // ì…ë ¥ê°’ ëˆ„ì 
                exp += (value == null) ? "" : value;
                exp += (operator == null) ? "" : operator;
                exp += (dot == null) ? "" : dot;
            }

            
            
            // ì¿ í‚¤ìƒì„±
            Cookie expCookie = new Cookie("exp",exp);
            if(operator !=null && operator.equals("C")) { // ì¡°ê±´ì— í•´ë‹¹ ë  ë•Œë§Œ
                expCookie.setMaxAge(0); // ì¿ í‚¤ì‚­ì œ(ë¸Œë¼ìš°ì €ì—ì„œ)
            }
            
            expCookie.setPath("/calculator");
            
            // ì¿ í‚¤ë¡œ ì €ì¥
            response.addCookie(expCookie);
            
            response.sendRedirect("calculator");
                    
        
        }

    }
    ```
    
â–¶ ì¶œë ¥
![cal](https://user-images.githubusercontent.com/65608960/113576598-cddd7d80-965a-11eb-953b-1f4bf0aff7ac.gif)


### âœ” MVC model1

    - Model : ì¶œë ¥ë°ì´í„°
    - Controller : ì…ë ¥ê³¼ ì œì–´ë¥¼ ë‹´ë‹¹ ( ìë°”ì½”ë“œ )
    - View : ì¶œë ¥ë‹´ë‹¹ (HTML ì½”ë“œ)
    - ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë·°ê°€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì§€ ì•Šì€ ë°©ì‹ì´ë‹¤

### âœ” MVC model2

    - ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë·°ê°€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ëœ ë°©ì‹
    - Dispatcherë¥¼ ì§‘ì¤‘í™” í•œ í›„ì˜ ëª¨ë¸

### âœ” EL(Expression Language)

    - ì €ì¥ ê°ì²´ì—ì„œ ê°’ì„ ì¶”ì¶œí•´ì„œ ì¶œë ¥í•˜ëŠ” í‘œí˜„ì‹

![ELë¡œì´ìš©ê°€ëŠ¥í•œê²ƒ](https://user-images.githubusercontent.com/65608960/113577050-9f13d700-965b-11eb-9eaf-d78b45b7bc4e.JPG)

### âœ” ì €ì¥ ê°ì²´ì—ì„œ ê°’ì„ ì¶”ì¶œí•˜ëŠ” ìˆœì„œ

    - page -> request -> session -> application (ELì„ ì´ìš©í•´ ê°ì²´ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤)


- ì½”ë“œ(jspì½”ë“œ)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

    <!-- ------------------------------- -->
    <!DOCTYPE html>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>spag</title>
    </head>
    <%
        pageContext.setAttribute("result", "hello");
    %>
    <body>
        <%=request.getAttribute("result") %> ì…ë‹ˆë‹¤.
        ${requestScope.result}<br>
        ${names[1]}<br>
        ${notice.title}<br>
        ${result}<br>
        ${empty param.n ? 'ê°’ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤' : param.n}<br>
        ${param.n/2 }<br>
        ${header.accept}
    </body>
    </html>
    ```
- ì½”ë“œ (ìë°”ì½”ë“œ : ì¶œë ¥ ì½”ë“œ)
    ```java
    package newlecture;

    import java.io.IOException;
    import java.util.HashMap;
    import java.util.Map;

    import javax.servlet.RequestDispatcher;
    import javax.servlet.ServletException;
    import javax.servlet.annotation.WebServlet;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    @WebServlet("/spag")
    public class spag extends HttpServlet {
        @Override
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            int num = 0;

            String num_ = request.getParameter("n");
            
            if(num_ != null && !num_.equals(""))
                num = Integer.parseInt(num_);
                
            String result;
            if(num %2!=0)
                result = "í™€ìˆ˜";
            else
                result = "ì§ìˆ˜";
            
            request.setAttribute("result", result);
            
            String[] names = {"hyun","ddong"};
            request.setAttribute("names",names);
            
            Map<String, Object> notice = new HashMap<String, Object>();
            notice.put("id", 1);
            notice.put("title", "ELì€ ì¢‹ì•„ìš”");
            request.setAttribute("notice",notice);
            
            
            // redirect : í˜„ì¬ ì‘ì—…í•œê²ƒê³¼ ìƒê´€ì—†ì´ ìƒˆë¡œìš´ ìš”ì²­
            // forward : í˜„ì¬ ì‘ì—…í•œ ë‚´ìš©ì„ ì´ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ê³µìœ 
            
            RequestDispatcher dispatcher = request.getRequestDispatcher("spag.jsp");
            
            dispatcher.forward(request, response);
        }

    }
    ```

â–¶ ì¶œë ¥ í™”ë©´
![jspì¶œë ¥](https://user-images.githubusercontent.com/65608960/113577047-9de2aa00-965b-11eb-88c0-0575733e7cdc.JPG)
