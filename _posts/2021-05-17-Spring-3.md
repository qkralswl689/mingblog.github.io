---
layout: post
title: 'Spring in Action - 3.ë°ì´í„°ë¡œ ì‘ì—…í•˜ê¸°_ 3.1 JDBCë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° ì½ê³  ì“°ê¸°'
date: 2021-05-17
category: [Spring]
comments: true
---

## ğŸ”· Spring in Action - 3.ë°ì´í„°ë¡œ ì‘ì—…í•˜ê¸°\_ 3.1 JDBCë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° ì½ê³  ì“°ê¸°

### âœ” 3.1 JDBCë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° ì½ê³  ì“°ê¸°

    - ìŠ¤í”„ë§ì˜ JDBC ì§€ì›ì€ JdbcTemplate í´ë˜ìŠ¤ì— ê¸°ë°˜ì„ ë‘”ë‹¤
    => JdbcTemplateì€ JDBCë¥¼ ì‚¬ìš©í•  ë•Œ ìš”êµ¬ë˜ëŠ” ëª¨ë“  í˜•ì‹ì ì´ê³  ìƒíˆ¬ì ì¸ ì½”ë“œ ì—†ì´ ê°œë°œìê°€ ê´€ê³„í˜• DBì— ëŒ€í•œ SQLì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤

- JdbcTemplateì„ ì‚¬ìš©í•´ DB ì¿¼ë¦¬ ì½”ë“œ

  ```java
  package tacos.data;

  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.jdbc.core.JdbcTemplate;
  import org.springframework.stereotype.Repository;
  import tacos.Ingredient;

  import java.sql.ResultSet;
  import java.sql.SQLException;

  // @Repository : ìŠ¤í”„ë§ ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ ìŠ¤í”„ë§ app ì»¨í…ìŠ¤íŠ¸ì˜ ë¹ˆìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤
  @Repository
  public class JdbcIngredientRepository implements IngredientRepository{

      private JdbcTemplate jdbc;

      @Override
      // findById() : í•˜ë‚˜ì˜ Ingredient ê°ì²´ ë°˜í™˜ => queryForObject() ì‚¬ìš©
      // ì²«ë²ˆì§¸ ì¸ì : SQL
      // ë‘ë²ˆì§¸ ì¸ì : ìŠ¤í”„ë§ì˜ RowMapper ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ mapRowToIngredient ë©”ì„œë“œ
      // ì„¸ë²ˆì§¸ ì¸ì : ê²€ìƒ‰í•  í–‰ì˜ id(ì‹ìì¬ id) ì „ë‹¬ => ì²«ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ëœ SQLì— ìˆëŠ” ? ëŒ€ì‹  êµì²´ë˜ì–´ ì¿¼ë¦¬ì— ì‚¬ìš©ëœë‹¤
      public Ingredient findById(String id) {
          return jdbc.queryForObject("select id, name, type from Ingredient where id=?",
                  this::mapRowToIngredient,id);
      }
      // mapRowToIngredient() : ì¿¼ë¦¬ë¡œ ìƒì„±ëœ ê²°ê³¼ ì„¸íŠ¸(Resultset ê°ì²´)ì˜ í–‰(row) ê°œìˆ˜ë§Œí¼ í˜¸ì¶œë˜ë©°
      // ê²°ê³¼ ì„¸íŠ¸ì˜ ëª¨ë“  í–‰ì„ ê°ê° ê°ì²´(Ingredient)ë¡œ ìƒì„±í•˜ê³  Listì— ì €ì¥í•œ í›„ ë°˜í™˜
      private Ingredient mapRowToIngredient(ResultSet rs, int rowNum)
              throws SQLException {
          return new Ingredient(
                  rs.getString("id"),
                  rs.getString("name"),
                  Ingredient.Type.valueOf(rs.getString("type")));
      }
  }
  ```

        - ìœ„ ì½”ë“œì—ëŠ” ëª…ë ¹ë¬¸ì´ë‚˜ DB ì—°ê²° ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œ, ë©”ì„œë“œ ì‹¤í–‰ í›„ ê°ì²´ë¥¼ í´ë¦°ì—…í•˜ëŠ” ì½”ë“œ ê°€ê°€ ì—†ê³  ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œë„ ì—†ë‹¤
        => ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ Imgredient ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì— ì´ˆì ì„ ë‘ëŠ” ì½”ë“œë§Œ ì¡´ì¬
        - JdbcTemplateì„ ì‚¬ìš©í•´ íƒ€ì½” í´ë¼ìš°ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì½ëŠ”ë° í•„ìš”í•œ ì½”ë“œì˜ ì¼ë¶€ë¶„ ì´ë‹¤

#### âœ” 3.1.1 í¼ì‹œìŠ¤í„´ìŠ¤ë¥¼ ê³ ë ¤í•œ ë„ë©”ì¸ ê°ì²´ ìˆ˜ì •í•˜ê¸°

- IDì™€ íƒ€ì„ìŠ¤íƒ¬í”„ í•„ë“œ Tacoí´ë˜ìŠ¤ì— ì¶”ê°€ ì½”ë“œ

  ```java
     package tacos;

    import java.util.Date;

    @Data
    public class Taco {
        private Long id;
        private Date createdAt;
    }
  ```

- IDì™€ íƒ€ì„ìŠ¤íƒ¬í”„ í•„ë“œ Orderí´ë˜ìŠ¤ì— ì¶”ê°€ ì½”ë“œ

  ```java
     package tacos;

    import java.util.Date;

    @Data
    public class Order {
        private Long id;
        private Date placedAt;
    }
  ```

        - íƒ€ì½”(Taco) ê°ì²´ê°€ ì–¸ì œ ìƒì„±ë˜ì—ˆëŠ”ì§€, ì£¼ë¬¸(Order)ì´ ì–¸ì œ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•„ë“œ ì¶”ê°€

#### âœ” 3.1.2 JdbcTemplate ì‚¬ìš©í•˜ê¸°

    ğŸˆ JDBC ë¦¬í¼ì§€í„°ë¦¬ ì •ì˜í•˜ê¸°
    - DBì˜ ëª¨ë“  ì‹ìì¬ ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•˜ì—¬ Imgredient ê°ì²´ ì»¬ë ‰ì…˜(List)ì— ë„£ì–´ì•¼ í•œë‹¤
    - idë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ Imgredientë¥¼ ì¿¼ë¦¬í•´ì•¼ í•œë‹¤
    - Imgredient ê°ì²´ë¥¼ DBì— ì €ì¥í•´ì•¼ í•œë‹¤

- ImtredientRepository ì¸í„°í˜ì´ìŠ¤ì— ìœ„ì˜ ì„¸ê°€ì§€ ì—°ì‚° ì¶”ê°€ ì½”ë“œ

  ```java
  package tacos.data;

  import tacos.Ingredient;

  public interface IngredientRepository {
      // DBì˜ ëª¨ë“  ì‹ìì¬ ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•˜ì—¬ Ingredient ê°ì²´ ì»¬ë ‰ì…˜(list)ì— ë„£ì–´ì•¼í•œë‹¤
      Iterable<Ingredient> findAll();

      // idë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ Ingredientë¥¼ ì¿¼ë¦¬í•´ì•¼ í•œë‹¤
      Ingredient findById(String id);

      // Ingredient ê°ì²´ë¥¼ DBì— ì €ì¥í•´ì•¼ í•œë‹¤
      Ingredient save(Ingredient ingredient);

  }
  ```

- JdbcTemplateë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹ìì¬ ë¦¬í¼ì§€í„°ë¦¬ ì‹œì‘ ì½”ë“œ

  ```java
  package tacos.data;

  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.jdbc.core.JdbcTemplate;
  import org.springframework.stereotype.Repository;
  import tacos.Ingredient;

  // @Repository : ìŠ¤í”„ë§ ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ ìŠ¤í”„ë§ app ì»¨í…ìŠ¤íŠ¸ì˜ ë¹ˆìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤
  @Repository
  public class JdbcIngredientRepository {

      private JdbcTemplate jdbc;

      @Autowired
      // JdbcIngredientRepository ë¹ˆì´ ìƒì„±ë˜ë©´ @Autowired ë¥¼ í†µí•´ ìŠ¤í”„ë§ì´ í•´ë‹¹ ë¹ˆì„ JdbcTemplate ì— ì—°ê²° í•œë‹¤
      // JdbcIngredientRepository(JdbcTemplate jdbc) : JdbcTemplate ì°¸ì¡°ë¥¼ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥
      // => DBì˜ ë°ì´í„°ë¥¼ ì¿¼ë¦¬, ì¶”ê°€í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ë©”ì„œë“œì— ì‚¬ìš© ëœë‹¤
      public JdbcIngredientRepository(JdbcTemplate jdbc){
          this.jdbc = jdbc;
      }
  }
  ```

- JdbcTemplateì„ ì‚¬ìš©í•´ DB ì¿¼ë¦¬ ì½”ë“œ

  ```java
  package tacos.data;

  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.jdbc.core.JdbcTemplate;
  import org.springframework.stereotype.Repository;
  import tacos.Ingredient;

  import java.sql.ResultSet;
  import java.sql.SQLException;

  // @Repository : ìŠ¤í”„ë§ ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ ìŠ¤í”„ë§ app ì»¨í…ìŠ¤íŠ¸ì˜ ë¹ˆìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤
  @Repository
  public class JdbcIngredientRepository implements IngredientRepository{

      private JdbcTemplate jdbc;

      @Autowired
      // JdbcIngredientRepository ë¹ˆì´ ìƒì„±ë˜ë©´ @Autowired ë¥¼ í†µí•´ ìŠ¤í”„ë§ì´ í•´ë‹¹ ë¹ˆì„ JdbcTemplate ì— ì—°ê²° í•œë‹¤
      // JdbcIngredientRepository(JdbcTemplate jdbc) : JdbcTemplate ì°¸ì¡°ë¥¼ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥
      // => DBì˜ ë°ì´í„°ë¥¼ ì¿¼ë¦¬, ì¶”ê°€í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ë©”ì„œë“œì— ì‚¬ìš© ëœë‹¤
      public JdbcIngredientRepository(JdbcTemplate jdbc){
          this.jdbc = jdbc;
      }


      @Override
      //  findAll() : ê°ì²´ê°€ ì €ì¥ëœ ì»¬ë ‰ì…˜ì„ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ
      public Iterable<Ingredient> findAll() {
          // query() : ë‘ê°œì˜ ì¸ìë¥¼ ë°›ëŠ”ë‹¤
          // ì²«ë²ˆì§¸ ì¸ì : SQL
          // ë‘ë²ˆì§¸ ì¸ì : ìŠ¤í”„ë§ì˜ RowMapper ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ mapRowToIngredient ë©”ì„œë“œ
          // query() ì—ì„œëŠ” í•´ë‹¹ ì¿¼ë¦¬ì—ì„œ ìš”êµ¬í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ë“¤ì˜ ë‚´ì—­ì„ ë§ˆì§€ë§‰ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤
          return jdbc.query("select id, name, type from Ingredient", this::mapRowToIngredient);
      }

      @Override
      // findById() : í•˜ë‚˜ì˜ Ingredient ê°ì²´ ë°˜í™˜ => queryForObject() ì‚¬ìš©
      // ì²«ë²ˆì§¸ ì¸ì : SQL
      // ë‘ë²ˆì§¸ ì¸ì : ìŠ¤í”„ë§ì˜ RowMapper ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ mapRowToIngredient ë©”ì„œë“œ
      // ì„¸ë²ˆì§¸ ì¸ì : ê²€ìƒ‰í•  í–‰ì˜ id(ì‹ìì¬ id) ì „ë‹¬ => ì²«ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ëœ SQLì— ìˆëŠ” ? ëŒ€ì‹  êµì²´ë˜ì–´ ì¿¼ë¦¬ì— ì‚¬ìš©ëœë‹¤
      public Ingredient findById(String id) {
          return jdbc.queryForObject("select id, name, type from Ingredient where id=?",
                  this::mapRowToIngredient,id);
      }
      // mapRowToIngredient() : ì¿¼ë¦¬ë¡œ ìƒì„±ëœ ê²°ê³¼ ì„¸íŠ¸(Resultset ê°ì²´)ì˜ í–‰(row) ê°œìˆ˜ë§Œí¼ í˜¸ì¶œë˜ë©°
      // ê²°ê³¼ ì„¸íŠ¸ì˜ ëª¨ë“  í–‰ì„ ê°ê° ê°ì²´(Ingredient)ë¡œ ìƒì„±í•˜ê³  Listì— ì €ì¥í•œ í›„ ë°˜í™˜
      private Ingredient mapRowToIngredient(ResultSet rs, int rowNum)
              throws SQLException {
          return new Ingredient(
                  rs.getString("id"),
                  rs.getString("name"),
                  Ingredient.Type.valueOf(rs.getString("type")));
      }
  }
  ```

        - â“ Iterable ëŠ” ë°˜ë³µë¬¸ ì¸ê°€?
        => ë°˜ë³µë¬¸ì´ë‹¤ -> ì»¬ë ‰ì…˜ì—ì„œ List, Set, Map Iteratorì˜ ìƒìœ„í´ë˜ìŠ¤ ì´ë‹¤

- JdbcTemplateì„ ì‚¬ìš©í•´ DBì— ë°ì´í„° ì¶”ê°€ ì½”ë“œ

  ```java
  // @Repository : ìŠ¤í”„ë§ ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ ìŠ¤í”„ë§ app ì»¨í…ìŠ¤íŠ¸ì˜ ë¹ˆìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤
  @Repository
  public class JdbcIngredientRepository implements IngredientRepository{
  // ë°ì´í„° ì¶”ê°€
      @Override
      public Ingredient save(Ingredient ingredient) {
          // update() : DBì— ë°ì´í„°ë¥¼ ì¶”ê°€,ë³€ê²½í•˜ëŠ” ì–´ë–¤ ì¿¼ë¦¬ì—ë„ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤
          jdbc.update("inwert into Ingredient (id, name, type) values (?,?,?)",
                  ingredient.getId(),
                  ingredient.getName(),
                  ingredient.getType().toString());
          return ingredient;
      }
  }
  ```

- ì»¨íŠ¸ë¡¤ëŸ¬ì— ë¦¬í¼ì§€í„°ë¦¬ ì£¼ì…í›„ ì‚¬ìš© ì½”ë“œ

  ```java
  package tacos.web;

  import java.util.ArrayList;
  import java.util.List;
  import java.util.stream.Collectors;
  import org.springframework.stereotype.Controller;
  import org.springframework.ui.Model;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.PostMapping;
  import org.springframework.web.bind.annotation.RequestMapping;
  import org.springframework.beans.factory.annotation.Autowired;

  import lombok.extern.slf4j.Slf4j;
  import tacos.Taco;
  import tacos.Order;
  import tacos.Ingredient;
  import tacos.Ingredient.Type;
  import tacos.data.IngredientRepository;
  import javax.validation.Valid;
  import org.springframework.validation.Errors;
  import tacos.data.TacoRepository;

  @Slf4j

  // @Controller : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‹ë³„ë˜ê²Œ í•˜ë©° ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì„ í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„
  // => ìŠ¤í”„ë§ì´ í•´ë‹¹í´ë˜ìŠ¤ë¥¼ ì°¾ì€í›„ ìŠ¤í”„ë§ APPì»´í…ìŠ¤íŠ¸ì˜ ë¹ˆ(Bean)ìœ¼ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ ìƒì„±í•œë‹¤
  @Controller

  // @RequestMapping : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì²˜ë¦¬í•˜ëŠ” ìš”ì²­ì˜ ì¢…ë¥˜
  // ìš”ì²­ ê²½ë¡œê°€ disign ì¸ HTTP GET ìš”ì²­ ì²˜ë¦¬
  @RequestMapping("/design")
  public class DesignTacoController {

      private final IngredientRepository ingredientRepo;

      // TacoRepositoryë¥¼ ì£¼ì…í•˜ì—¬ íƒ€ì½” ì €ì¥ì‹œ ì‚¬ìš©
      private TacoRepository tacoRepo;

      @Autowired
      // showDesign(), processDesign() ë©”ì„œë“œì—ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë„ë¡ ë‘ ì¸ì ëª¨ë‘ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥í•œë‹¤
      public DesignTacoController(IngredientRepository ingredientRepo) {
          this.ingredientRepo = ingredientRepo;
      }

      // @GetMapping : /disignì˜ HTTP GET ìš”ì²­ì´ ìˆ˜ì‹ ë  ë•Œ ê·¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ showDesignForm() ë©”ì„œë“œê°€ í˜¸ì¶œ ë˜ëŠ”ê²ƒì„ ë‚˜íƒ€ë‚¸ë‹¤
      @GetMapping
      public String showDesignForm(Model model){
          // Ingredient ê°ì²´ ì €ì¥í•˜ëŠ” List ìƒì„±

          // jdbc ì—°ê²°ë•Œë¬¸ì— ì‚­ì œ
      /* List<Ingredient> ingredients = Arrays.asList(
                  new Ingredient("FLTO", "Flour Tortilla", Type.WRAP),
                  new Ingredient("COTO", "Corn Tortilla", Type.WRAP),
                  new Ingredient("GRBF", "Ground Beef", Type.PROTEIN),
                  new Ingredient("CARN", "Carnitas", Type.PROTEIN),
                  new Ingredient("TMTO", "Diced Tomatoes", Type.VEGGIES),
                  new Ingredient("LETC", "Lettuce", Type.VEGGIES),
                  new Ingredient("CHED", "Cheddar", Type.CHEESE),
                  new Ingredient("JACK", "Monterrey Jack", Type.CHEESE),
                  new Ingredient("SLSA", "Salsa", Type.SAUCE),
                  new Ingredient("SRCR", "Sour Cream", Type.SAUCE)
          );*/
          // ì‹ìì¬ ë‚´ì—­ ìƒì„± => ì‹ìì¬ì˜ ë‚´ì—­(ìœ í˜•)ì„ List ì—ì„œ í•„í„°ë§(filterByType ë©”ì„œë“œ) í•œ í›„
          // showDesignForm()ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” Model ê°ì²´ì˜ ì†ì„±ìœ¼ë¡œ ì¶”ê°€í•œë‹¤
          // Model : ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” ë·° ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ ìš´ë°˜í•˜ëŠ” ê°ì²´

          // ìœ„ì˜ í•˜ë“œì½”ë”© í–ˆë˜ Ingredient ê°ì²´ì˜ List ëŒ€ì‹  DBë¡œë¶€í„° ì½ì€ ë°ì´í„°ë¡œ ìƒì„±í•œ Ingredient ê°ì²´ì˜ Listë¥¼ ì œê³µ í•  ìˆ˜ ìˆë‹¤
          List<Ingredient> ingredients = new ArrayList<>();
          ingredientRepo.findAll().forEach(i -> ingredients.add(i));

          Type[] types = Type.values();
          for(Type type : types){
              model.addAttribute(type.toString().toLowerCase(),
                      filterByType(ingredients, type));
          }
          model.addAttribute("taco",new Taco());
          // design ì„ ë¦¬í„´ í•œë‹¤ => ëª¨ë¸ ë°ì´í„°ë¥¼ ë¸Œë¼ìš°ì €ì— ë‚˜íƒ€ë‚˜ëŠ” ë° ì‚¬ìš©ë  ë·°ì˜ ë…¼ë¦¬ì ì¸ ì´ë¦„
          return "design";
      }
  }
  ```

#### âœ” 3.1.3 ìŠ¤í‚¤ë§ˆ ì •ì˜ í•˜ê³  ë°ì´í„° ì¶”ê°€í•˜ê¸°

    - í…Œì´ë¸” ë§Œë“¤ê¸° -> Taco_Order, Taco_Order_Tacos, Taco, Taco_Ingredients, Ingredient
    - Ingredient : ì‹ìì¬ ì •ë³´ ì €ì¥
    - Taco : ì‚¬ìš©ìê°€ ì‹ìì¬ ì„ íƒí•˜ì—¬ ìƒì„±í•œ íƒ€ì½” ë””ìì¸ì— ê´€í•œ ì •ë³´ ì €ì¥
    - Taco_Ingredients : í…Œì´ë¸”ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤
        => Taco í…Œì´ë¸”ì˜ ê° í–‰ì— ëŒ€í•´ í•˜ë‚˜ ì´ìƒì˜ í–‰(íƒ€ì½”ë¥¼ ì‹ìì¬ì™€ ì—°ê´€ì‹œí‚¤ëŠ”)ì„ í¬í•¨í•œë‹¤
    - Taco_Order : ì£¼ë¬¸ ì •ë³´ ì €ì¥
    - Taco_Order_Tacos : Taco_Orderì™€ Taco í…Œì´ë¸”ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤
        => Taco_Orderì™€ í…Œì´ë¸”ì˜ ê°í–‰ì— ëŒ€í•´ í•˜ë‚˜ ì´ìƒì˜ í–‰(ì£¼ë¬¸ì„ íƒ€ì½”ì™€ ì—°ê´€ì‹œí‚¤ëŠ”)ì„ í¬í•¨í•œë‹¤

- íƒ€ì½” í´ë¼ìš°ë“œ ìŠ¤í‚¤ë§ˆ ì •ì˜ SQL

  ```sql
  create table if not exists Ingredient (
  id varchar(4) not null,
  name varchar(25) not null,
  type varchar(10) not null
  );

  create table if not exists Taco (
  id identity,
  name varchar(50) not null,
  createdAt timestamp not null
  );

  create table if not exists Taco_Ingredients (
  taco bigint not null,
  ingredient varchar(4) not null
  );

  alter table Taco_Ingredients
      add foreign key (taco) references Taco(id);
  alter table Taco_Ingredients
      add foreign key (ingredient) references Ingredient(id);

  create table if not exists Taco_Order (
  id identity,
      deliveryName varchar(50) not null,
      deliveryStreet varchar(50) not null,
      deliveryCity varchar(50) not null,
      deliveryState varchar(2) not null,
      deliveryZip varchar(10) not null,
      ccNumber varchar(16) not null,
      ccExpiration varchar(5) not null,
      ccCVV varchar(3) not null,
      placedAt timestamp not null
  );

  create table if not exists Taco_Order_Tacos (
  tacoOrder bigint not null,
  taco bigint not null
  );

  alter table Taco_Order_Tacos
      add foreign key (tacoOrder) references Taco_Order(id);
  alter table Taco_Order_Tacos
      add foreign key (taco) references Taco(id);

  ```

#### âœ” 3.1.4 íƒ€ì½”ì™€ ì£¼ë¬¸ ë°ì´í„° ì¶”ê°€í•˜ê¸°

    - JdbcTemplateì„ ì‚¬ìš©í•´ ë°ì´í„° ì €ì¥í•˜ëŠ” ë°©ë²• 2ê°€ì§€
    1. ì§ì ‘ update() ë©”ì„œë“œ ì‚¬ìš©
    2. SimpleJdbcInsert ë˜í¼ í´ë˜ìŠ¤ ì‚¬ìš©

- Taco ê°ì²´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì½”ë“œ

  ```java
  package tacos.data;

  import tacos.Taco;

  // Taco ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ”ë° í•„ìš”í•œ ì¸í„°í˜ì´ìŠ¤
  public interface TacoRepository {
      Taco save(Taco design);
  }
  ```

- Order ê°ì²´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì½”ë“œ

  ```java
  package tacos.data;

  import tacos.Order;

  // Order ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ”ë° í•„ìš”í•œ ì¸í„°í˜ì´ìŠ¤
  public interface OrderRepository {
      Order save(Order order);
  }
  ```

- JdbcTemplateì„ ì‚¬ìš©í•´ TacoRepository êµ¬í˜„ ì½”ë“œ

  ```java
  package tacos.data;

  import org.springframework.jdbc.core.JdbcTemplate;
  import org.springframework.jdbc.core.PreparedStatementCreator;
  import org.springframework.jdbc.core.PreparedStatementCreatorFactory;
  import org.springframework.jdbc.support.GeneratedKeyHolder;
  import org.springframework.jdbc.support.KeyHolder;
  import org.springframework.stereotype.Repository;
  import tacos.Ingredient;
  import tacos.Taco;


  import java.sql.Timestamp;
  import java.sql.Types;
  import java.util.Arrays;
  import java.util.Date;

  @Repository
  public class JdbcTacoRepository implements TacoRepository{

      private JdbcTemplate jdbc;

      public JdbcTacoRepository(JdbcTemplate jdbc){
          this.jdbc = jdbc;
      }


      @Override
      // save() : Taco í…Œì´ë¸”ì— ê° ì‹ìì¬ë¥¼ ì €ì¥í•˜ëŠ” saveTacoInfo() ë©”ì„œë“œ í˜¸ì¶œ
      public Taco save(Taco taco) {
          // ë°˜í™˜ëœ íƒ€ì½” idë¥¼ ì‚¬ìš©í•´ íƒ€ì½”ì™€ ì‹ìì¬ì˜ ì—°ê´€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” saveIngredientToTaco() í˜¸ì¶œ
          long tacoId = saveTacoInfo(taco);
          taco.setId(tacoId);
          for (Ingredient ingredient : taco.getIngredients()) {
              saveIngredientToTaco(ingredient, tacoId);
          }
          return taco;
      }

      private long saveTacoInfo(Taco taco) {

          taco.setCreatedAt(new Date());
          PreparedStatementCreator psc = new PreparedStatementCreatorFactory(
                  "insert into Taco (name, createdAt) values (?, ?)",
                  Types.VARCHAR, Types.TIMESTAMP)
                  .newPreparedStatementCreator(
                  Arrays.asList(
                          taco.getName(),
                          new Timestamp(taco.getCreatedAt().getTime())));

          KeyHolder keyHolder = new GeneratedKeyHolder();

          // íƒ€ì½” IDë¥¼ ì–»ê¸°ìœ„í•´
          // update() : PreparedStatementCreator ê°ì²´ì™€ KeyHolder ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤
          // KeyHolder : ìƒì„±ëœ íƒ€ì½” ID ì œê³µ => ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” PreparedStatementCreator ë„ ìƒì„±í•´ì•¼ í•œë‹¤
          jdbc.update(psc, keyHolder);

          // update()ì˜ ì‹¤í–‰ì´ ëë‚˜ë©´ keyHolder.getKey().longValue()ì˜ ì—°ì†í˜¸ì¶œë¡œ íƒ€ì½” IDë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤
          return keyHolder.getKey().longValue() ;
      }

      // save() ë©”ì„œë“œë¡œ ì œì–´ê°€ ë³µê·€ ëœ í›„ saveIngredientToTaco()ë¥¼ í˜¸ì¶œí•˜ì—¬
      // ê°ì²´ì˜ Listì— ì €ì¥ëœ ê° Imgredient ê°ì²´ë¥¼ ë°˜ë³µ ì²˜ë¦¬í•œë‹¤.
      private void saveIngredientToTaco(Ingredient ingredient, long tacoId) {
          // update()ë¥¼ ì‚¬ìš©í•´ íƒ€ì½” IDì™€ Ingredient ê°ì²´ ì°¸ì¡°ë¥¼ Taco_Ingredients í…Œì´ë¸”ì— ì €ì¥í•œë‹¤
          jdbc.update(
                  "insert into Taco_Ingredients (taco, ingredient) " +
                          "values (?,?)",
                  tacoId, ingredient.getId());
      }
  }
  ```

        - â“ saveTacoInfo ì—ì„œ calues(?, ?)ê°’ì„ ì§€ì •í•´ì£¼ëŠ” ìˆ«ì í•„ìš”ì—†ëŠ”ì§€?
        => í•„ìš”ì—†ë‹¤, PreparedStatementCreator psc = new PreparedStatementCreatorFactory() ê³¼
           .newPreparedStatementCreator() ëŠ” ê°™ì´ ì‚¬ìš©í–‰ í•œë‹¤
        - PreparedStatementCreator psc = new PreparedStatementCreatorFactory() : íƒ€ì… ë§Œ ëª…ì‹œ
        - .newPreparedStatementCreator() : ê°’ ë“±ë¡

- TacoRepository ì£¼ì…í›„ ì‚¬ìš© ì½”ë“œ

  ```java

  @Slf4j
  @Controller
  @RequestMapping("/design")
  public class DesignTacoController {

  private final IngredientRepository ingredientRepo;

  // TacoRepositoryë¥¼ ì£¼ì…í•˜ì—¬ íƒ€ì½” ì €ì¥ì‹œ ì‚¬ìš©
  private TacoRepository tacoRepo;

  @Autowired
  // showDesign(), processDesign() ë©”ì„œë“œì—ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë„ë¡ ë‘ ì¸ì ëª¨ë‘ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥í•œë‹¤
  public DesignTacoController(IngredientRepository ingredientRepo,TacoRepository tacoRepo) {
      this.ingredientRepo = ingredientRepo;
      this.tacoRepo = tacoRepo;
  }
  ```

- íƒ€ì½” ë””ìì¸ ì €ì¥í•˜ê³  ì£¼ë¬¸ê³¼ ì—°ê²°í•˜ëŠ” ì½”ë“œ

  ```java
  package tacos.web;

  import java.util.ArrayList;
  import java.util.List;
  import java.util.stream.Collectors;
  import org.springframework.stereotype.Controller;
  import org.springframework.ui.Model;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.PostMapping;
  import org.springframework.web.bind.annotation.RequestMapping;
  import org.springframework.beans.factory.annotation.Autowired;

  import lombok.extern.slf4j.Slf4j;
  import tacos.Taco;
  import tacos.Order;
  import tacos.Ingredient;
  import tacos.Ingredient.Type;
  import tacos.data.IngredientRepository;
  import javax.validation.Valid;
  import org.springframework.validation.Errors;
  import tacos.data.TacoRepository;
  import org.springframework.web.bind.annotation.ModelAttribute;
  import org.springframework.web.bind.annotation.SessionAttributes;


  @Slf4j

  // @Controller : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‹ë³„ë˜ê²Œ í•˜ë©° ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì„ í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„
  // => ìŠ¤í”„ë§ì´ í•´ë‹¹í´ë˜ìŠ¤ë¥¼ ì°¾ì€í›„ ìŠ¤í”„ë§ APPì»´í…ìŠ¤íŠ¸ì˜ ë¹ˆ(Bean)ìœ¼ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ ìƒì„±í•œë‹¤
  @Controller

  // @RequestMapping : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì²˜ë¦¬í•˜ëŠ” ìš”ì²­ì˜ ì¢…ë¥˜
  // ìš”ì²­ ê²½ë¡œê°€ disign ì¸ HTTP GET ìš”ì²­ ì²˜ë¦¬
  @RequestMapping("/design")

  // Orderì˜ ë‹¤ìˆ˜ì˜ HTTP ìš”ì²­ì— ê±¸ì²˜ ì¡´ì¬ í•´ì•¼í•œë‹¤ => ë‹¤ìˆ˜ì˜ íƒ€ì½”ë¥¼ ìƒì„±í•˜ê³  í•˜ë‚˜ì˜ ì£¼ë¬¸ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´
  // í´ë˜ìŠ¤ ìˆ˜ì¦Œì˜ @SessionAttributes ì„ ì£¼ë¬¸ê³¼ ê°™ì€ ëª¨ë¸ ê°ì²´ì— ì§€ì • => ì„¸ì…˜ì—ì„œ ê³„ì† ë³´ì¡´ë˜ë©´ì„œ ë‹¤ìˆ˜ì˜ ìš”ì²­ì— ê±¸ì³ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤
  @SessionAttributes("order")
  public class DesignTacoController {


      // @ModelAttribute(name = "order") : Order ê°ì²´ê°€ ëª¨ë¸ì— ìƒì„±ë˜ë„ë¡ í•´ì¤€ë‹¤
      @ModelAttribute(name = "order")
      public Order order(){
          return new Order();
      }

      @ModelAttribute(name = "taco")
      public Taco taco(){
          return new Taco();
      }

      // /design ê²½ë¡œì˜ POST ìš”ì²­ì„ ì²˜ë¦¬ => taco ë¥¼ ë””ìì¸ í•˜ëŠ” ì‚¬ìš©ìê°€ ì œì¶œí•œ ê²ƒì„ ì—¬ê¸°ì—ì„œ ì²˜ë¦¬í•œë‹¤
      @PostMapping
      // processDesign() ë©”ì„œë“œì—ì„œëŠ” taco ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ì–´ë–¤ ê²ƒì´ë“  ì›í•˜ëŠ” ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤
      // @Valid : ì œì¶œëœ taco ê°ì²´ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰ í•˜ë¼ê³  ìŠ¤í”„ë§ MVC ì— ì•Œë ¤ì¤€ë‹¤

      // @ModelAttribute => ë§¤ê°œë³€ìˆ˜ì˜ ê°’(order)ì´ ëª¨ë¸ë¡œë¶€í„° ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒê³¼ ìŠ¤í”„ë§ MVCê°€ ì´ ë§¤ê°œë³€ìˆ˜ì— ìš”ì²­ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°”ì¸ë”© í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚¸ë‹¤
      public String processDesign(@Valid Taco design, Errors errors, @ModelAttribute Order order){
          // Errors ê°ì²´ì˜ hsErrors() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ê²€ì‚¬ ì—ëŸ¬ê°€ ìˆëŠ”ì§€ í™•ì¸
          // ì—ëŸ¬ê°€ ìˆìœ¼ë©´ taco ì˜ ì²˜ë¦¬ë¥¼ ì¤‘ì§€í•˜ê³  "disign" ë·° ì´ë¦„ì„ ë°˜í™˜í•˜ì—¬ í¼ì´ ë‹¤ì‹œ ë³´ì´ê²Œ í•œë‹¤
          if(errors.hasErrors()){
              return "design";
          }
          //log.info("Processing design: " + design);

          // ì£¼ì…ëœ TacoRepository(tacoRepo) ë¥¼ ì‚¬ìš©í•´ íƒ€ì½” ì €ì¥ í›„
          Taco saved = tacoRepo.save(design);
          // ì„¸ì…˜ì— ë³´ì¡´ëœ Orderì—ì„œ Taco ê°ì²´ë¥¼ ì¶”ê°€í•œë‹¤
          order.addDesign(saved);


          // redirect : processDesign()ì˜ ì‹¤í–‰ì´ ëë‚œ í›„ ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ê°€ /orders/current ìƒëŒ€ ê²½ë¡œë¡œ ì¬ì ‘ì†ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚¸ë‹¤
          return "redirect:/orders/current";
      }
  }
  ```

          - â“ @ModelAttribute
          => view ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ë¦„ì„ ì§€ì •í•œë‹¤

  â• ì°¸ê³  : <http://ojc.asia/bbs/board.php?bo_table=LecSpring&wr_id=856>

- SimpleJdbcInsert ìƒì„± ì½”ë“œ

  ```java
  package tacos.data;

  import com.fasterxml.jackson.databind.ObjectMapper;
  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.jdbc.core.JdbcTemplate;
  import org.springframework.jdbc.core.simple.SimpleJdbcInsert;
  import org.springframework.stereotype.Repository;
  import tacos.Order;
  import tacos.Taco;

  import java.util.Date;
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;


  @Repository
  public class JdbcOrderRepository implements OrderRepository{

      private SimpleJdbcInsert orderInserter;
      private SimpleJdbcInsert orderTacoInserter;
      private ObjectMapper objectMapper;

      @Autowired
      // ìƒì„±ì í†µí•´ JdbcTemplate ì£¼ì…
      public JdbcOrderRepository(JdbcTemplate jdbc)
      {
          // JdbcTemplate ì„ ì‚¬ìš©í•´ ë‘ê°œì˜ SimpleJdbcInsert ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

          this.orderInserter = new SimpleJdbcInsert(jdbc)
                  // Taco_Order í…Œì´ë¸”ì— ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ êµ¬ì„±
                  .withTableName("Taco_Order")
                  // Order ê°ì²´ì˜ id ì†ì„± ê°’ì€ DBê°€ ìƒì„±í•´ ì£¼ëŠ”ê²ƒì„ ì‚¬ìš©í•œë‹¤
                  .usingGeneratedKeyColumns("id");

          this.orderTacoInserter = new SimpleJdbcInsert(jdbc)
                  // Taco_Order_Tacos í…Œì´ë¸”ì— í•´ë‹¹ ì£¼ë¬¸ id ë° ì—°ê´€ëœ íƒ€ì½”ë“¤ì˜ id ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ êµ¬ì„±
                  // =>but ì–´ë–¤ id ê°’ë“¤ì„ Taco_Order_Tacos í…Œì´ë¸”ì˜ ë°ì´í„°ì— ìƒì„±í•  ê²ƒì¸ì§€ëŠ” ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤
                  .withTableName("Taco_Order_Tacos");

          this.objectMapper = new ObjectMapper();
      }
  }
  ```

- SimpleJdbcInsertë¥¼ ì‚¬ìš©í•´ ë°ì´í„° ì¶”ê°€í•˜ëŠ” ì½”ë“œ

  ```java
  @Repository
  public class JdbcOrderRepository implements OrderRepository{

    @Override
    // save() ë©”ì†Œë“œ : ì‹¤ì œë¡œ ì €ì¥í•˜ëŠ” ì¼ X => Order ë° ì—°ê´€ëœ Taco ê°ì²´ë“¤ì„ ì €ì¥í•˜ëŠ” ì²˜ë¦¬ë¥¼ ì´ê´„í•œë‹¤
    public Order save(Order order) {
        order.setPlacedAt(new Date());
        long orderId = saveOrderDetails(order);
        order.setId(orderId);
        List<Taco> tacos = order.getTacos();

        for(Taco taco : tacos){
            saveTacoToOrder(taco, orderId);
        }
        return order;
    }

    // ì‹¤ì œ ì €ì¥í•˜ëŠ” ì¼ => saveOrderDetails(),saveTacoToOrder() ë©”ì„œë“œì—ì„œ ì²˜ë¦¬í•œë‹¤
    // execute() , executeAndReturnKey() : ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ë©”ì„œë“œ
    // ë‘ ë©”ì„œë“œ ëª¨ë‘ Map<String,Object> ë¥¼ ì´ìë¡œ ë°›ëŠ”ë‹¤
    // => Mapì˜ í‚¤ : ë°ì´í„°ê°€ ì¶”ê°€ë˜ëŠ” í…Œì´ë¸”ì˜ ì—´(column) ì´ë¦„ê³¼ ëŒ€ì‘
    // => Mapì˜ ê°’ : í•´ë‹¹ ì—´ì— ì¶”ê°€ë˜ëŠ” ê°’
        private long saveOrderDetails(Order order) {

        @SuppressWarnings("uncheked")

        // objectMapper.convertValue(order, Map.class) : order ë¥¼ Map ìœ¼ë¡œ ë³€í™˜
        Map<String, Object> values = objectMapper.convertValue(order, Map.class);

        // Map ì´ ìƒì„±ë˜ë©´ í‚¤ê°€ placedAt ì¸ í•­ëª©ì˜ ê°’ì„ Order ê°ì²´ì˜ placedAt ì†ì„± ê°’ìœ¼ë¡œ ë³€ê²½í•œë‹¤
        // => objectMapper ëŠ” Date íƒ€ì…ì˜ ê°’ì„ long íƒ€ì…ì˜ ê°’ìœ¼ë¡œ ë³€í™˜í•´ Taco_Order í…Œì´ë¸”ì˜ placedAt ì—´ê³¼ íƒ€ì…ì´ í˜¸í™˜ë˜ì§€ ì•Šê¸° ë•Œë¬¸
        values.put("placedAt", order.getPlacedAt());

        // executeAndReturnKey() : í•´ë‹¹ ì£¼ë¬¸ ë°ì´í„°ê°€ Taco_Order í…Œì´ë¸”ì— ì €ì¥ëœ í›„ DBì—ì„œ ìƒì„±ëœ IDê°€ Number ê°ì²´ë¡œ ë°˜í™˜ëœë‹¤
        // ë”°ë¼ì„œ ì—°ì†ìœ¼ë¡œ longValue()ë¥¼ í˜¸ì¶œí•˜ì—¬ saveOrderDetails() ë©”ì„œë“œì—ì„œ ë°˜í™˜í•˜ëŠ” long íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤
        long orderId = orderInserter.executeAndReturnKey(values).longValue();
        return orderId;
    }

    private void saveTacoToOrder(Taco taco, long orderId) {

        // ê°ì²´ë¥¼ Map ìœ¼ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ ObjectMapper ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  Mapì„ ìƒì„±í•˜ê³  ê° í•­ëª©ì— ì í•©í•œ ê°’ì„ ì„¤ì •í•œë‹¤
        Map<String,Object> values = new HashMap<>();
        values.put("tacoOrder", orderId);
        values.put("taco", taco.getId());

        // exexute() ë©”ì„œë“œ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤
        orderTacoInserter.execute(values);
    }

  }
  ```

        - â“ @SuppressWarnings("uncheked")
        => ì»´íŒŒì¼ëŸ¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ê²½ê³ í•˜ëŠ” ë‚´ìš© ì¤‘ "ì´ê±´ í•˜ì§€ë§ˆ"í•˜ê³  ì œì™¸ì‹œí‚¬ ë•Œ ì“´ë‹¤

- OrderControllerì—ì„œ OrderRepository ì‚¬ìš© ì½”ë“œ

  ```java
  package tacos.web;

  import lombok.extern.slf4j.Slf4j;
  import org.springframework.stereotype.Controller;
  import org.springframework.ui.Model;
  import org.springframework.validation.Errors;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.PostMapping;
  import org.springframework.web.bind.annotation.RequestMapping;
  import org.springframework.web.bind.annotation.SessionAttributes;
  import org.springframework.web.bind.support.SessionStatus;
  import tacos.Order;
  import tacos.data.OrderRepository;

  import javax.validation.Valid;

  @Slf4j
  @Controller
  // @RequestMapping : /orders ë¡œ ì‹œì‘ë˜ëŠ” ê²½ë¡œì˜ ìš”ì²­ì„ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ìš”ì²­ ì²˜ë¦¬ ë©”ì„œë“œê°€ ì²˜ë¦¬í•œë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ì• ë…¸í…Œì´ì…˜
  @RequestMapping("/orders")
  @SessionAttributes("order")
  public class OrderController {

      private OrderRepository orderRepo;

      public OrderController(OrderRepository orderRepo) {
          this.orderRepo = orderRepo;
      }
      // order ê°ì²´ ì„¸ì…˜ ë³´ì „í•˜ê¸°ìœ„í•´ ì•„ë˜ì²˜ëŸ¼ ë³€ê²½
  /*    @GetMapping("/current")
      public String orderForm(Model model) {
          model.addAttribute("order", new Order());
          return "orderForm";
      }*/

      @GetMapping("/current")
      public String orderForm() {
          return "orderForm";
      }

      // Order ìœ íš¨ì„± ê²€ì‚¬
      @PostMapping
      // processOrder() ë©”ì„œë“œëŠ”  SessionStatusë¥¼ ì¸ìë¡œ ì „ë‹¬ë°›ì•„
      // setComplete() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì„¸ì…˜ì„ ì¬ì„¤ì • í•œë‹¤
      public String processOrder(@Valid Order order, Errors errors, SessionStatus sessionStatus) {
          if (errors.hasErrors()) {

              // orderForm ì„ ë¦¬í„´í•œë‹¤
              return "orderForm";
          }

          //log.info("Order submitted: " + order);

          // processOrder() ë©”ì„œë“œì—ì„œ ì£¼ì…ëœ OrderRepository ì˜ save() ë©”ì„œë“œë¥¼ í†µí•´ í¼ì—ì„œ ì œì¶œëœ Order ê°ì²´ë¥¼ ì €ì¥í•œë‹¤
          // => Order ê°ì²´ë„ ì„¸ì…˜ì— ë³´ì¡´ë˜ì–´ì•¼ í•œë‹¤
          orderRepo.save(order);

          // ì„¸ì…˜ ì¬ì„¤ì •
          sessionStatus.setComplete();

          return "redirect:/";
      }
  }
  ```

- DBì˜ ì‹ìì¬ ë°ì´í„° Ingredient ê°ì²´ë¡œ ë³€í™˜ ì½”ë“œ

  ```java
  package tacos.web;

  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.core.convert.converter.Converter;
  import org.springframework.stereotype.Component;

  import tacos.Ingredient;
  import tacos.data.IngredientRepository;

  // Converter : ë°ì´í„°ì˜ íƒ€ì…ì„ ë³€í™˜í•´ì£¼ëŠ” í´ë˜ìŠ¤
  // @Component : ìŠ¤í”„ë§ì— ì˜í•´ ìë™ ìƒì„± ë° ì£¼ì…ë˜ëŠ” ë¹ˆìœ¼ë¡œ ìƒì„±
  @Component
  // Converter<String, Ingredient> : String => ë³€í™˜í•  ê°’ì˜ íƒ€ì…, Ingredient => ë³€í™˜ëœ ê°’ì˜ íƒ€ì…
  public class IngredientByIdConverter implements Converter<String, Ingredient> {

      private IngredientRepository ingredientRepo;

      // @Autowired : IngredientRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ë¹ˆ(JdbcIngredientRepository) ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ìì˜ ì¸ìë¡œ ì£¼ì…ëœë‹¤
      @Autowired
      public IngredientByIdConverter(IngredientRepository ingredientRepo){
          this.ingredientRepo = ingredientRepo;
      }
      @Override
      public Ingredient convert(String id) {
          // IngredientRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ JdbcIngredientRepository í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì˜ findById() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤
          // findById() : ë³€í™˜í•  String ê°’ì„ idë¡œ ê°–ëŠ” ì‹ìì¬ ë°ì´í„°ë¥¼ DB ì—ì„œ ì°¾ëŠ”ë‹¤
          // => JdbcIngredientRepository ì˜ private ë©”ì„œë“œì¸ mapRowToIngredient() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ê²°ê³¼ ì„¸íŠ¸ì˜ í–‰ ë°ì´í„°ë¥¼ ì†ì„± ê°’ìœ¼ë¡œ ê°–ëŠ” Ingredient ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤
          return ingredientRepo.findById(id);
      }
  }
  ```
