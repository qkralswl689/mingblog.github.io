---
layout: post
title: "JAVA -JDBC í”„ë¡œê·¸ë˜ë° - DBì—°ê²°/í•´ì œ(íƒ€ì…ë³„), ë‹¨ìœ„í…ŒìŠ¤íŠ¸ "
date: 2021-03-10
category : [JAVA]
comments: true
---

## ğŸ”·JDBC í”„ë¡œê·¸ë˜ë°  - DBì—°ê²°/í•´ì œ(íƒ€ì…ë³„), ë‹¨ìœ„í…ŒìŠ¤íŠ¸

- DBì—°ê²°/í•´ì œ(íƒ€ì…ë³„) 
    ```java
    package com.javateam.jdbc.member.util;

    import java.sql.Connection;
    import java.sql.DriverManager;
    import java.sql.SQLException;
    import java.sql.Statement;
    import java.sql.ResultSet;

    /**
    * DB ì—°ê²°/í•´ì œ ìœ í‹¸ë¦¬í‹°(Utility)
    * <br><br>
    * usage (ì‚¬ìš© ìš©ë¡€)
    * <br>
    * DB ì—°ê²° : DbUtil.connect();
    * DB ì—°ê²° í•´ì œì‹œ : DbUtil.close(con, pstmt, rs);
    * 
    * @author mingki
    * @version 1.0
    * 
    */

    public class DbUtil {
        
        /** DB ì—°ê²° ì •ë³´ */
        
        /** JDBC ë“œë¼ì´ë²„(driver) */
        static final String DRIVER = "oracle.jdbc.OracleDriver";
        // static final String driver = "oracle.jdbc.driver.OracleDriver"; (O)
        
        /** JDBC URL */	
        static final String URL = "jdbc:oracle:thin:@localhost:1521:xe";
        
        /** DB account(ID) */
        static final String USER_ID = "java";
        
        /** DB account(PW) */
        static final String USER_PW = "java";
        
        /** 
        
        /**
        * ì—­í•  : DB ì—°ê²°
        * <br><br>
        * ìš©ë¡€ : DbUtil.connect();
        * <br>
        * @return DB ì—°ê²° ê°ì²´
        */
        
        // í•¨ìˆ˜ ìƒì„±(ì¸ì)
        // Connection : jdbc ì—°ê²°
        public static Connection connect() {
            
            /** DB ì—°ê²° ê°ì²´ */
            Connection con = null;
            
            // JDBC driver ë“±ë¡
            try {
                Class.forName(DRIVER);	
                
                // JDBC URL, ID, PW ë¥¼ ì´ìš©í•´ ì—°ê²° ê°ì²´ ìƒì„±
                try {				
                    
                    con = DriverManager.getConnection(URL, USER_ID, USER_PW); 
                    
                } catch (SQLException e) {
                    System.out.println("DB ì—°ê²°ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    e.printStackTrace();
                }
                
            } catch (ClassNotFoundException e) {
                System.out.println("JDBC ë“œë¼ì´ë²„ ë¡œë”©ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                e.printStackTrace();
            }		
            return con;
        }
        /**
        * DB ì—°ê²° í•´ì œ(ìì› ë°˜ë‚©)
        * <br><br>
        *  ìš©ë¡€) DbUtil.connect(con, pstmt, rs); // select
        *  	 DbUtil.connect(con, pstmt, null); // insert, update, delete
        *  <br>
        * @param con  : DB ì—°ê²° ê°ì²´
        * @param stmt : stmt SQL ì²˜ë¦¬ ê°ì²´
        * @param rs : SQL ê²°ê³¼ì…‹ ê°ì²´
        */
        
        // ë°˜í™˜ê°’ì´ ì—†ì„ ë•Œ (void)
        public static void close(Connection con, Statement stmt, ResultSet rs) {
            
            try {
                if(rs != null) {
                    rs.close();
                    System.out.println("SQL ê²°ê³¼ì…‹ì„ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");
                }// if(!rs.isClosed()) rs.close(); // (O)
                // if(rs.isClosed() == false) rs.close(); // (O)
                if(stmt != null) {
                    stmt.close();
                    System.out.println("SQL ì²˜ë¦¬ ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");
                }
                // if(stmt.isClose() == false) stmt.close(); // (O)
                if(con != null) {
                    con.close();
                    System.out.println("DB ì—°ê²° ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");

                }
                // if(con.isClosed()==false) con.close(); // (O)
            } catch (SQLException e) {
                System.out.println("DB ìì› ë°˜ë‚©ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                e.printStackTrace();
                
            }
            
        }
            // ë°˜í™˜ê°’ boolean ì¼ ë•Œ
        public static boolean close(Connection con, Statement stmt, ResultSet rs) {
            
            boolean result = false;
            
            try {
                if(rs != null) {
                    rs.close();
                    System.out.println("SQL ê²°ê³¼ì…‹ì„ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    result = true;
                }
                if(stmt != null) {
                    stmt.close();
                    System.out.println("SQL ì²˜ë¦¬ ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    result = true;
                }
                if(con != null) {
                    con.close();
                    System.out.println("DB ì—°ê²° ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    result = true;

                }
                // if(con.isClosed()==false) con.close(); // (O)
            } catch (SQLException e) {
                System.out.println("DB ìì› ë°˜ë‚©ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                e.printStackTrace();
                result = false;
                
            }
            
            return result;
        }
        
            // ë°˜í™˜ ê°’ String ì¼ ë•Œ
            public static String close(Connection con, Statement stmt, ResultSet rs) {
            
            String result = "";
            
            try {
                if(rs != null) {
                    rs.close();
                    result +="SQL ê²°ê³¼ì…‹ì„ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.\n";
                }
                if(stmt != null) {
                    stmt.close();
                    result +="SQL ì²˜ë¦¬ ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.\n";
                }
                if(con != null) {
                    con.close();
                    result +="DB ì—°ê²° ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤.\n";	
                }
            } catch (SQLException e) {
                System.out.println("DB ìì› ë°˜ë‚©ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                e.printStackTrace();
                
            }
            
            return result;
        }
        
        // ë°˜í™˜ ê°’ int ì¼ ë•Œ 
        public static int close(Connection con, Statement stmt, ResultSet rs) {
                
                int result = 0;
                
                try {
                    if(rs != null) {
                        rs.close();
                        result = 1;
                    }
                    if(stmt != null) {
                        stmt.close();
                        result = 2;
                    }
                    if(con != null) {
                        con.close();
                        result = 3;	
                    }
                } catch (SQLException e) {
                    System.out.println("DB ìì› ë°˜ë‚©ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    e.printStackTrace();
                }
                return result;
            }
    }
    ```
    
- ë‹¨ìœ„í…ŒìŠ¤íŠ¸
    ```java
    package com.javateam.jdbc.member.test;

    import java.sql.Connection;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;

    import com.javateam.jdbc.member.util.DbUtil;
    /**
    * DbUtil ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test) : í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(Test Case)
    * 
    * í…ŒìŠ¤íŠ¸ ì¡°ê±´)
    * 
    * 1) DB ì—°ê²° í…ŒìŠ¤íŠ¸
    * 
    * 2) DB ì—°ê²° ìì› ë°˜ë‚©(í•´ì œ) í…ŒìŠ¤íŠ¸
    * 
    * @author mingki
    *
    */
    public class DbConnectionTest {

        public static void main(String[] args) throws SQLException {
            
            // í…ŒìŠ¤íŠ¸ ê²°ê³¼ => ë‹¨ì–¸(ë‹¨ì •) : assertion
            String msg = DbUtil.connect() != null ? "DB ì—°ê²° ì„±ê³µ" : "DB ì—°ê²° ì‹¤íŒ¨" ; // void
            System.out.println("ì—°ê²° ì„±ê³µ ì—¬ë¶€ : " + msg);
            
            // statement í…ŒìŠ¤íŠ¸
            Connection con = DbUtil.connect();
            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT * FROM member");
            
            DbUtil.close(DbUtil.connect(), stmt, null); 
            
             boolean result = DbUtil.close(DbUtil.connect(), stmt, null); // boolean
            System.out.println("ë°˜ë‚© ì„±ê³µ ì—¬ë¶€ : " + result);
            
    		String result = DbUtil.close(DbUtil.connect(), stmt, rs); // String
    		System.out.println("ë°˜ë‚© ì„±ê³µ ì—¬ë¶€(ë©”ì„¸ì§€) :\n " + result);
            
            int result = DbUtil.close(DbUtil.connect(), stmt, rs); // int
            String msg = 
            result == 1 ? "SQL ì²˜ë¦¬ ê°ì²´ë¥¼ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤. " :			
            result == 3 ? "DB ì—°ê²° ê°ì²´ê¹Œì§€ ë°˜ë‚©í•˜ì˜€ìŠµë‹ˆë‹¤." :					
            result == 6 ? "DB ìì›ê¹Œì§€ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤." : "";
            System.out.println("ë°˜ë‚© ì„±ê³µ ì—¬ë¶€(ë©”ì„¸ì§€) : " + msg);
        }

    }
    ```