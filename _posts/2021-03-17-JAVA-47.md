---
layout: post
title: "JAVA -JDBC í”„ë¡œê·¸ë˜ë° - DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(isEnablePhone(Phone/ id,Phone),search) "
date: 2021-03-17
category : [JAVA]
comments: true
---

## ğŸ”·JDBC -  DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(isEnablePhone(Phone/ id,Phone),search)


- DAO êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±
    ```java
     package com.javateam.jdbc.member.dao.Impl;

    import java.sql.Connection;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;

    import java.util.ArrayList;
    import java.util.List;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.domain.MemberVo;
    import com.javateam.jdbc.member.util.DbUtil;

    /**
    * MemberDaoì˜ êµ¬í˜„ í´ë˜ìŠ¤(concrete class)<br><br>
    * 
    *
    * ìš©ë¡€) MemberDao dao = MemberdaoImpl.getInstance();<br>
    * : ì‹±í´í„´(singleton:ë…ì‹ ì) íŒ¨í„´ ì ìš© &rarr; ë³´ì•ˆ<br><br>
    *  
    * @author mingki
    *
    */
    public class MemberDaoImpl implements MemberDao {
        
        /** DAO ê°ì²´ : ì‹±í´í„´(singleton) ìƒì„± íŒ¨í„´ ì ìš©*/
        private static MemberDaoImpl instance = null;
        private MemberDaoImpl() {}
        
        /**
        * ì‹±ê¸€í„´ ê°ì²´(DAO singleton object) ìƒì„± ë©”ì„œë“œ 
        * 
        * @return DAO ê°ì²´
        */
        public static final MemberDaoImpl getInstance() {
            // final : ì˜¤ë²„ë¼ì´ë“œ ê¸ˆì§€
            
            if(instance == null) {
                instance = new MemberDaoImpl();
            }
            return instance;
        }

       	@Override
        @Override
        public boolean isEnablePhone(String memberPhone) {
		// ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
		 boolean result = false;
		// ì‹¤í–‰ ë©”ì„œë“œëª…  
		 ExceptionMetadata emd = new ExceptionMetadata(new Exception().getStackTrace()[0]);
		 
		// DB ì—°ê²°
		 Connection con = DbUtil.connect();
		 
		// SQL ì²˜ë¦¬ ê°ì²´
		 PreparedStatement pstmt = null;
		 
		// ê²°ê³¼ì…‹ ê°ì²´ (DOL : select)
		 ResultSet rs = null;

		// SQL êµ¬ë¬¸
		 String sql = "SELECT count(*) FROM member "
		 		+ "WHERE member_phone = ? ";

		// SQL, ì¸ì (ì„ )ì²˜ë¦¬
		 try {
			// SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„± 			 
			pstmt=con.prepareStatement(sql);
			
			pstmt.setString(1, memberPhone);
			
			rs = pstmt.executeQuery();
			// SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
			
			if(rs.next()) {
				result = rs.getInt(1) == 1 ? false:true ;
			}

		} catch (SQLException e) {
			emd.printErr(e, con, false);
			
		// ìì› ë°˜ë‚©
		} finally {
			DbUtil.close(con, pstmt, rs);
			
		}
		// ë¦¬í„´(ë°˜í™˜)
		return result;
	    }

        @Override
        public boolean isEnablePhone(String memberId, String memberPhone) {
		// ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
		 boolean result = false;
		 
		// ì‹¤í–‰ ë©”ì„œë“œëª…  
		  ExceptionMetadata emd = new ExceptionMetadata(new Exception().getStackTrace()[0]);

		// DB ì—°ê²°
		  Connection con = DbUtil.connect();

		// SQL ì²˜ë¦¬ ê°ì²´
		  PreparedStatement pstmt = null;

		// ê²°ê³¼ì…‹ ê°ì²´ (DOL : select)
		  ResultSet rs = null;

		// SQL êµ¬ë¬¸
		  String sql = "SELECT count(*) FROM member " + 
		  		"WHERE member_id != ? AND member_phone = ? ";

		// SQL, ì¸ì (ì„ )ì²˜ë¦¬
		  
		  try {
			pstmt = con.prepareStatement(sql);
			
			pstmt.setString(1,memberId);
			pstmt.setString(2,memberPhone);
			
			// SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„±
			rs = pstmt.executeQuery();
			
	
			if(rs.next()) {
				result = rs.getInt(1)==0 ?true : false;
			}else {
				result = false;
			}
			// SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
		} catch (SQLException e) {
			emd.printErr(e, con, false);
			
			// ìì› ë°˜ë‚©
		}finally {
			DbUtil.close(con, pstmt, rs);
		}

		// ë¦¬í„´(ë°˜í™˜)
		return result;
	    }

        /**
        * ë…¼ë¦¬ì  ê²€ìƒ‰ì–´ë¥¼ ë¬¼ë¦¬ í•„ë“œëª…ìœ¼ë¡œ ë³€í™˜<br><br>
        * ex) ì´ë¦„ &rarr; member_name<br><br>
        * 
        * @param searchWord ê²€ìƒ‰ì–´
        * @return ê²€ìƒ‰ì–´ì— í•´ë‹¹ë˜ëŠ” ë¬¼ë¦¬ í•„ë“œ
        */
        private String getFieldBySearchWord(String searchWord) {
            
            String result = "";
            
            searchWord = searchWord.trim(); // ê²€ìƒ‰ì–´ ê³µë°± ì œê±°
            
            result = searchWord.contentEquals("ì´ë¦„") ? "member_name" : 
                    searchWord.contentEquals("ì•„ì´ë””") ? "member_id" :
                    searchWord.contentEquals("ë³„ëª…") ? "member_nickname" :
                    searchWord.contentEquals("ì—°ë½ì²˜") ? "member_phone" : 
                    searchWord.contentEquals("ì´ë©”ì¼") ? "member_email" : 
                    searchWord.contentEquals("ê¸°ë³¸ì£¼ì†Œ") ? "member_address_basic" :	 
                    searchWord.contentEquals("ìƒì„¸ì£¼ì†Œ") ? "member_address_detail" :
                    searchWord.contentEquals("ìƒì¼") ? "member_birth" :
                    searchWord.contentEquals("ê°€ì…ì¼") ? "member_joindate" : null;	 
                        
            return result;
        }

	@Override
	public List<MemberVo> getMembersBySearching(String searchKey, String searchValue, boolean isEquivalentSearch,
			String sortDirection, int page, int limit) {
		
		// ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
		List<MemberVo> members = new ArrayList<>();
		 
		// ì‹¤í–‰ ë©”ì„œë“œëª…  
		MemberVo member = null;
		
		// íŠ¸ëœì­ì…˜ / ì˜ˆì™¸ì²˜ë¦¬ ê°ì²´ ìƒì„±
		ExceptionMetadata emd = new ExceptionMetadata(new Exception().getStackTrace()[0]);

		// DB ì—°ê²°
		Connection con = DbUtil.connect();
		
		// SQL ì²˜ë¦¬ ê°ì²´
		PreparedStatement pstmt = null;

		// ê²°ê³¼ì…‹ ê°ì²´
		ResultSet rs = null;
		
		
		// SQL êµ¬ë¬¸
		// Whereì ˆ ë³€ìˆ˜
		// ì¡°ê±´ì— ë”°ë¼ ë™ë“±/ìœ ì‚¬  ê²€ìƒ‰ WHEREì ˆ(clause) ì„ íƒì  ì¡°ì •
		try {
		String searchField = this.getFieldBySearchWord(searchKey);
		if(searchField == null) {
			throw new SQLException("ê²€ìƒ‰ì–´ì— í•´ë‹¹ë˜ëŠ” í…Œì´ë¸” í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
		}
		

	
		// ë™ë“± ë° ìœ ì‚¬ ê²€ìƒ‰ì¼ ê²½ìš°ë¥¼ êµ¬ë¶„í•˜ì—¬ í‘œí˜„ì‹ êµ¬ì„±
		// 1)
		String whereClause = isEquivalentSearch == true ? searchField + " = " + searchValue + " " : 
														  searchField + " like '%' || '" + searchValue + "' || '%' ";
		
		// 2) 
		if (searchField.equals("member_birth") || searchField.equals("member_joindate")) {

			// TO_CHAR(member_joindate, 'YYYY-MM-DD') í˜•ì‹ ì ìš©
			// ex) WHERE TO_CHAR(member_joindate, 'YYYY-MM-DD') = TO_DATE('2021-03-16') 
			
			searchField = "TO_CHAR(" + searchField + ", 'YYYY-MM-DD') ";
			
			whereClause = isEquivalentSearch == true ? searchField + " = '" + searchValue + "' " : 
	    												searchField + " like '%' || '" + searchValue + "' || '%' ";
			
			System.out.println("whereì ˆ : " + whereClause);
			
			String sql = "SELECT * " + 
					 "FROM (SELECT ROWNUM, " + 
					 "             m.*, " + 
					 "             FLOOR((ROWNUM - 1) / ? + 1) page " + 
					 "      FROM (" + 
					 "             SELECT * FROM member " + 
					 " 			   WHERE " + whereClause + " " +
					 "             ORDER BY member_id " + sortDirection + " " +
					 "           ) m " + 
					 "      ) " + 
					 "WHERE page = ?";
    //	String sql = "SELECT * " + 
    //			"FROM (SELECT ROWNUM,  " + 
    //			"             m.*,   " + 
    //			"             FLOOR((ROWNUM - 1) / ? + 1) page  " + 
    //			"      FROM (  " + 
    //			"             SELECT * FROM member " + 
    //			"             W WHERE member_name like"+ "'%" +searchKey + "%' " + 
    //			"             ORDER BY member_id " + sortDirection + 
    //			"           ) m    " + 
    //			"      )    " + 
    //			"WHERE page = ? ";
        // SQL, ì¸ì (ì„ )ì²˜ë¦¬
        
            pstmt = con.prepareStatement(sql);
            
            // SQL ê²½ê³  ë©”ì„¸ì§€
            pstmt.setInt(1, limit);
            pstmt.setInt(2, page);
            
            System.out.println("sql : " +sql);
            
            rs = pstmt.executeQuery();
            
            while(rs.next()) {
                member = new MemberVo();
                
                member.setMemberId(rs.getString("member_Id"));
                member.setMemberPassword(rs.getString("member_Password"));
                member.setMemberNicname(rs.getString("member_Nickname"));
                member.setMemberName(rs.getString("member_Name"));
                member.setMemberGender(rs.getString("member_Gender").charAt(0)); // charë¡œ ë³€í™˜
                member.setMemberEmail(rs.getString("member_Email"));
                member.setMemberPhone(rs.getString("member_Phone"));
                member.setMemberBirth(rs.getDate("member_Birth"));
                member.setMemberZip(rs.getString("member_Zip"));
                member.setMemberAddressBasic(rs.getString("member_Address_Basic"));
                member.setMemberAddressDetail(rs.getString("member_Address_Detail"));
                member.setMemberJoindate(rs.getDate("member_JoinDate"));
                
                
                // VO -> List ë¡œ ì´ê´€(add) : ê°œë³„ íšŒì›ì •ë³´ ì¶”ê°€
                members.add(member);
            }
				
		}
		
		} catch (SQLException e) {
			emd.printErr(e, con, false);
		}finally {
			DbUtil.close(con, pstmt, rs);
		}		
		return members;
	}	
    ```

- isEnablePhone(memberPhone) í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤

    ```java
    package com.javateam.jdbc.member.test;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;

    public class isEnablePhoneTest {

        public static void main(String[] args) {

            MemberDao dao = MemberDaoImpl.getInstance();
            
            System.out.println("ìˆëŠ” ë²ˆí˜¸ í™•ì¸ (010-3078-0694) : " + dao.isEnablePhone("010-3078-0694"));
            
            System.out.println("ì—†ëŠ” ë²ˆí˜¸ í™•ì¸ (010-1111-1111) : " + dao.isEnablePhone("010-1111-1111"));

        }

    }
    ```
â–¶ ì¶œë ¥ í™”ë©´ 
![isEnablePhone](https://user-images.githubusercontent.com/65608960/111460583-7e90e500-875f-11eb-92c0-4307a0f9ddfc.JPG)


- isEnablePhone(memberId,memberPhone) í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
   package com.javateam.jdbc.member.test;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;

    public class isEnablePhoneTest2 {

        public static void main(String[] args) {

            MemberDao dao = MemberDaoImpl.getInstance();
            

            System.out.println("ì•„ì´ë”” O,ë³¸ì¸ ì „í™”ë²ˆí˜¸ O : " + dao.isEnablePhone("hyun", "010-3078-0694"));
            System.out.println("ì•„ì´ë”” O,ì „í™”ë²ˆí˜¸ X : " + dao.isEnablePhone("hyun", "010-3078-0644"));
            System.out.println("ì•„ì´ë”” O,íƒ€ì¸ ì „í™”ë²ˆí˜¸ O : " + dao.isEnablePhone("hyun", "010-1234-1001"));
        }

    }
    ```

â–¶ ì¶œë ¥ í™”ë©´ 
![isEnablePhone2](https://user-images.githubusercontent.com/65608960/111460791-bd269f80-875f-11eb-95c9-ccb0af7c8668.JPG)



- getMembersBySearching í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
   package com.javateam.jdbc.member.test;

    import java.util.ArrayList;
    import java.util.List;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    import com.javateam.jdbc.member.domain.MemberVo;
    /**
    * getMembersBySearching ë©”ì„œë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(Unit TestCase)<br>
    * : ê²€ìƒ‰ì–´ë¥¼ í†µí•œ í˜ì´ì§• ì§€ì› íšŒì›ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸<br><br>
    * 
    * @author mingki
    *
    */
    public class getMemberBySearchingTest {

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao = MemberDaoImpl.getInstance();
            
            // ê°ì¢… ê²€ìƒ‰ì–´(ê²€ìƒ‰ í•„ë“œ)ë¥¼ ì ìš©í•˜ì—¬ ê²€ìƒ‰í•©ë‹ˆë‹¤.
            
                // List<MemberVo> members = dao.getMembersBySearching("ì´ë¦„", "ê¸¸ë™", false, "ASC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ì´ë¦„2", "ê¸¸ë™", false, "ASC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ì´ë¦„", "ê¸¸ë™", false, "DESC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ê¸°ë³¸ì£¼ì†Œ", "ì¢…ë¡œ2", false, "DESC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ê¸°ë³¸ì£¼ì†Œ", "ì¢…ë¡œ", false, "DESC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ìƒì¼", "1990-01-02", false, "DESC", 1, 10); 
                // List<MemberVo> members = dao.getMembersBySearching("ìƒì¼", "1990-01-02", true, "DESC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ìƒì¼", "1990-01-02", true, "DESC", 1, 10);
                // List<MemberVo> members = dao.getMembersBySearching("ê°€ì…ì¼", "1990-01-02", true, "DESC", 1, 10);
                List<MemberVo> members = dao.getMembersBySearching("ê°€ì…ì¼", "2021-03-15", false, "DESC", 1, 10);
                //List<MemberVo> members = dao.getMembersBySearching("ê°€ì…ì¼", "2021-03-11", true, "DESC", 1, 10);

                for (MemberVo m : members) {
                    System.out.println(m);
                }
                
            // ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œ
            //System.out.println(dao.getMembersBySearching("member_name", "ìˆœ", true, "ASC", 1, 10));
        }
    }
    ```

â–¶ ì¶œë ¥ í™”ë©´ 
![getMemberBySearchingTest](https://user-images.githubusercontent.com/65608960/111460975-fe1eb400-875f-11eb-920b-bf2bbd3aa728.JPG)
