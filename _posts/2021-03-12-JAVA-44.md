---
layout: post
title: "JAVA -JDBC í”„ë¡œê·¸ë˜ë° - DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(getAll, get, delete) "
date: 2021-03-12
category : [JAVA]
comments: true
---

## ğŸ”·JDBC í”„ë¡œê·¸ë˜ë° - DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(getAll, get, delete)


- DAO êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±
    ```java
    package com.javateam.jdbc.member.dao.Impl;

    import java.sql.Connection;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;

    import java.util.ArrayList;
    import java.util.List;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.domain.MemberVo;
    import com.javateam.jdbc.member.util.DbUtil;

    /**
    * MemberDaoì˜ êµ¬í˜„ í´ë˜ìŠ¤(concrete class)<br><br>
    * 
    *
    * ìš©ë¡€) MemberDao dao = MemberdaoImpl.getInstance();<br>
    * : ì‹±í´í„´(singleton:ë…ì‹ ì) íŒ¨í„´ ì ìš© &rarr; ë³´ì•ˆ<br><br>
    *  
    * @author mingki
    *
    */
    public class MemberDaoImpl implements MemberDao {
        
        /** DAO ê°ì²´ : ì‹±í´í„´(singleton) ìƒì„± íŒ¨í„´ ì ìš©*/
        private static MemberDaoImpl instance = null;
        private MemberDaoImpl() {}
        
        /**
        * ì‹±ê¸€í„´ ê°ì²´(DAO singleton object) ìƒì„± ë©”ì„œë“œ 
        * 
        * @return DAO ê°ì²´
        */
        public static final MemberDaoImpl getInstance() {
            // final : ì˜¤ë²„ë¼ì´ë“œ ê¸ˆì§€
            
            if(instance == null) {
                instance = new MemberDaoImpl();
            }
            return instance;
        }

        @Override
        public boolean insertMember(MemberVo member) {
            
            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            boolean result = false; // ê²°ê³¼ê°’ ì´ˆê¸°í™”
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…(reflection ì‚¬ìš©)
            String methodName 
            = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null; // 1)
            // Statement pstmt = null; // 2)
            // ì°¸ê³ ) Statement pstmt = null; // ? (ì™€ì¼ë“œ ì¹´ë“œ) ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤
            // ì°¸ê³ ) CallableStatment : PL/SQL ì „ìš©
            
            // SQL êµ¬ë¬¸
            String sql = "INSERT INTO member VALUES "  
                    + "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, sysdate)";		
            
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬
            try {
                pstmt = con.prepareStatement(sql); // 1) SQL(prepare) ì„ ì²˜ë¦¬
                // pstmt = con.createStatment(); // 2) SQL í›„ì²˜ë¦¬
                pstmt.setString(1, member.getMemberId());
                pstmt.setString(2, member.getMemberPassword());
                pstmt.setString(3, member.getMemberNicname());
                pstmt.setString(4, member.getMemberName());
                pstmt.setString(5, member.getMemberGender() + ""); // char -> String ë³€í™˜ ìœ„í•´ ë’¤ì— "" ë¶™íŒë‹¤
                pstmt.setString(6, member.getMemberEmail());
                pstmt.setString(7, member.getMemberPhone());
                pstmt.setDate(8,member.getMemberBirth());
                pstmt.setString(9, member.getMemberZip());
                pstmt.setString(10, member.getMemberAddressBasic());
                pstmt.setString(11, member.getMemberAddressDetail());
                
                // SQL ì‹¤í–‰, ë¦¬í„´ê°’ ì²˜ë¦¬, ì˜ˆì™¸ì²˜ë¦¬
                if (pstmt.executeUpdate() == 1) { // 1 : DML ì‹¤í–‰ ì„±ê³µí•œ í–‰(tuple, record)ì˜ ìˆ˜
                    
                    System.out.println("íšŒì›ì •ë³´ ì €ì¥ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
                    result = true;
                    
                } else {
                    
                    System.out.println("íšŒì›ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                    // result = false;
                }
            } catch (SQLException e) {
                System.err.println(methodName + " : " + " íšŒì›ì •ë³´ ì €ì¥ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
                System.err.println(methodName + " : " + e.getMessage());
                // System.err.println(methodName + " : " + "íšŒì›ì •ë³´ ì €ì¥ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
                e.printStackTrace();
            } finally {
                // ìì› ë°˜ë‚©
                DbUtil.close(con, pstmt, null);
            } //
            
            // ë¦¬í„´(ë°˜í™˜)
            return result;
        }

        @Override
        public List<MemberVo> getAllMembers() {
            
            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            List<MemberVo> members = new ArrayList<>(); // List ì‚¬ìš©
            
            // ê°œë³„ íšŒì›ì •ë³´ ê°ì²´ ì„ ì–¸
            MemberVo member = null;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String methodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // SQL ê²°ê³¼ì…‹ ê°ì²´(DQL:select)
            ResultSet rs = null;
            
            // SQL êµ¬ë¬¸
            String sql = "SELECT * FRom member";
            
            try {
                // SQL ì²˜ë¦¬
                pstmt = con.prepareStatement(sql);
                
                // SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„±
                rs = pstmt.executeQuery();
                
                // next() : ê²°ê³¼ì…‹ì—ì„œ ë‹¤ìŒ í–‰ì„ ì¡°íšŒí•˜ëŠ” ë°©ì‹(iterator)
                while(rs.next()) { 
                    
                    // ê°œë³„ íšŒì›ì •ë³´ ìƒì„±
                    // ì£¼ì˜) VO ê°ì²´ ì´ êµ¬ë¬¸ì—ì„œ ì„ ì–¸  => íŠ¹ì • ê°œë³„ íšŒì›ë“¤ë§Œ ì—¬ëŸ¬í–‰ ì¶œë ¥ëœë‹¤ (ì•ˆì¢‹ë‹¤)
                    // => ëŒ€ì±… : VO ê°ì²´ ì™¸ë¶€ì—ì„œ ì„ ì–¸í•œë‹¤ -> ë¦¬í„´ì²˜ë¦¬ë¬¸ ì•„ë˜ì— ì„ ì–¸(MemberVo member = null;)
                    // MemberVo member = new MemberVo(); //=> í•œëª…ì´ ì—¬ëŸ¬ë²ˆ ë‚˜ì˜¤ëŠ” ë²„ê·¸ ë°œìƒ
                    member = new MemberVo(); // (O)
                    
                    // SQL ê²°ê³¼ì…‹ -> VOì—  ì´ê´€
                    member.setMemberId(rs.getString("member_Id"));
                    member.setMemberPassword(rs.getString("member_Password"));
                    member.setMemberNicname(rs.getString("member_Nickname"));
                    member.setMemberName(rs.getString("member_Name"));
                    member.setMemberGender(rs.getString("member_Gender").charAt(0)); // charë¡œ ë³€í™˜
                    member.setMemberEmail(rs.getString("member_Email"));
                    member.setMemberPhone(rs.getString("member_Phone"));
                    member.setMemberBirth(rs.getDate("member_Birth"));
                    member.setMemberZip(rs.getString("member_Zip"));
                    member.setMemberAddressBasic(rs.getString("member_Address_Basic"));
                    member.setMemberAddressDetail(rs.getString("member_Address_Detail"));
                    member.setMemberJoindate(rs.getDate("member_JoinDate"));
                    
                    // VO -> List ë¡œ ì´ê´€(add) : ê°œë³„ íšŒì›ì •ë³´ ì¶”ê°€
                    members.add(member);
                    
                }
                // SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
            }catch(SQLException e) {
                System.out.println(methodName + " : " + e.getMessage());
                
            } finally {
                // ìì› ë°˜ë‚©
                DbUtil.close(con, pstmt, rs);		
            
        } // ë¦¬í„´(ë°˜í™˜)
            return members ;
        }

        @Override
        public MemberVo getMember(String memberId) {
            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            MemberVo member = new MemberVo();
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String methodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // SQL ê²°ê³¼ì…‹ ê°ì²´(DQL : select)
            ResultSet rs = null;
            
            // SQL êµ¬ë¬¸
            String sql = "SELECT * FROM member WHERE member_id= ? ";
            
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬, SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
            try {
                pstmt = con.prepareStatement(sql);
                pstmt.setString(1, memberId);
                
                rs = pstmt.executeQuery();
                
                // í•œì¤„ ë‚˜ì˜¤ê¸°ë•Œë¬¸ì— whileë¬¸ ì•ˆì¨ë„ë¨
                if(rs.next()) {
                    member.setMemberId(rs.getString("member_Id"));
                    member.setMemberPassword(rs.getString("member_Password"));
                    member.setMemberNicname(rs.getString("member_Nickname"));
                    member.setMemberName(rs.getString("member_Name"));
                    member.setMemberGender(rs.getString("member_Gender").charAt(0)); // charë¡œ ë³€í™˜
                    member.setMemberEmail(rs.getString("member_Email"));
                    member.setMemberPhone(rs.getString("member_Phone"));
                    member.setMemberBirth(rs.getDate("member_Birth"));
                    member.setMemberZip(rs.getString("member_Zip"));
                    member.setMemberAddressBasic(rs.getString("member_Address_Basic"));
                    member.setMemberAddressDetail(rs.getString("member_Address_Detail"));
                    member.setMemberJoindate(rs.getDate("member_JoinDate"));
                    
                    
                }
                
            }catch(SQLException e) {
                System.out.println(methodName + " : " + e.getMessage());
                
            }finally {
                // ìì› ë°˜ë‚©
                DbUtil.close(con, pstmt, rs);
            }
                    
            // ë¦¬í„´(ë°˜í™˜)
            return member;
        }

        @Override
        public boolean updateMember(MemberVo member) {
            // ë¦¬í„´ ì²˜ë¦¬
            boolean result = false;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…
            String methodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DBì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // SQL êµ¬ë¬¸
            
            // 1) 
    //		String sql = "UPDATE member SET "
    //					+ "member_password=?,member_nickname = ?,member_birth=?,"
    //					+ "member_address_basic=?,member_address_detail=? "
    //					+ "WHERE MEMBER_ID= ? ";
            
            // 2)
            StringBuilder sql = new StringBuilder();
            sql.append("UPDATE member SET ");
            sql.append("member_Password = ?,");
            sql.append("member_nickname = ?,");
            sql.append("member_birth=?,");
            sql.append("member_address_basic=?,");
            sql.append("member_address_detail=? ");
            sql.append("WHERE MEMBER_ID=?");
            
            // SQL, ì¸ì(ì„ ) ì²˜ë¦¬
            
            try {
                // 1) pstmt = con.prepareStatement(sql);
                
                // 2) sql.toString : StringBulderë¥¼ ë³€í™˜í•´ì„œ ì‚¬ìš©
                pstmt = con.prepareStatement(sql.toString());
                
                pstmt.setString(1, member.getMemberPassword());
                pstmt.setString(2, member.getMemberNicname());
                pstmt.setDate(3, member.getMemberBirth());
                pstmt.setString(4, member.getMemberAddressBasic());
                pstmt.setString(5, member.getMemberAddressDetail());
                pstmt.setString(6, member.getMemberId());
                // SQL ì‹¤í–‰, ë¦¬í„´ê°’ ì²˜ë¦¬, ì˜ˆì™¸ì²˜ë¦¬
                if(pstmt.executeUpdate()==1) {
            //	pstmt.executeUpdate() > 2 ) { // ì—¬ëŸ¬ëª… ì •ë³´ ìˆ˜ì •ì‹œ ì¡°ê±´ë¬¸ì˜ˆì‹œ
                    System.out.println("íšŒì›ì •ë³´ ìˆ˜ì •ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
                    result = true;
                }else {
                    System.out.println("íšŒì›ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                }
                    
            } catch (SQLException e) {
                System.err.println(methodName + ": " +"íšŒì›ì •ë³´ ì €ì¥ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
                System.err.println(methodName + " : " + e.getMessage());
                e.printStackTrace();
            }finally {
                // ìì› ë°˜ë‚©
                DbUtil.close(con, pstmt, null);
            }
            return result;
        }

        @Override
        public boolean deleteMember(String memberId) {
            
            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            boolean result = false;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String MethodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // SQL êµ¬ë¬¸
            String sql = "DELETE member WHERE member_id=?";
            
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬
            try {
                pstmt = con.prepareStatement(sql);
                
                pstmt.setString(1, memberId);
                if(pstmt.executeUpdate()==1) {
                    System.out.println("íšŒì›ì •ë³´ ì‚­ì œê°€ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤");
                    result = true;
                }else {
                    System.out.println("íšŒì›ì •ë³´ ì‚­ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤");
                }
            
                // SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
            }catch(SQLException e) {
                System.out.println(MethodName + " : " + "íšŒì›ì •ë³´ ì‚­ì œì‹œ ì˜ˆì™¸ ë°œìƒ");
                System.out.println(MethodName + " : " + e.getMessage());
                
            } finally {
                // ìì› ë°˜ë‚©
                DbUtil.close(con, pstmt, null);
            }		
            // ë¦¬í„´(ë°˜í™˜)
            return result;
        }

    }
    ```

- getAllMembers í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤

    ```java
    package com.javateam.jdbc.member.test;

    import java.util.ArrayList;
    import java.util.List;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    import com.javateam.jdbc.member.domain.MemberVo;
    /**
    * getAllMembers ë©”ì„œë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(Unit TestCase)<br><br>
    * : ì „ì²´ íšŒì›ì •ë³´ ì¡°íšŒ<br><br>
    * 
    * @author mingki
    *
    */
    public class AllMembersTest {

        public static int getCountByWord(List<String> list, String id) {
                
                int count = 0;
        
                for (int i=0; i<list.size(); i++) {
                    
                    if (list.get(i).contentEquals(id)) {
                        count++;
                    }
                }
                
                return count;
            }
        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao = MemberDaoImpl.getInstance();
            
            // ì¸ì›ìˆ˜ í™•ì¸
            System.out.println("ì¸ì›ìˆ˜ í™•ì¸ : " + (dao.getAllMembers().size()==8 ? true: false));
            
            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì ê²€ ì‚¬í•­
            // ì¤‘ë³µí–‰ ì¶œë ¥ ì—¬ë¶€ ì ê²€
            // ê° í–‰ì— ëŒ€í•œ íšŒì› ì•„ì´ë””ë¥¼ ì¤‘ë³µì„± ì ê²€
            List<String> ids = new ArrayList<>();
            
            // ì „ì²´ í˜„í™© í™•ì¸
            for (MemberVo m : dao.getAllMembers()) {
                // System.out.println(m);
                ids.add(m.getMemberId());
                
            }
            List<MemberVo> list = dao.getAllMembers();
            // id ì¤‘ë³µì—¬ë¶€ ì¶œë ¥
            for(int i=0; i<list.size();i++) {
                String id = list.get(i).getMemberId(); 
                    System.out.println(id + ":" + getCountByWord(ids,id));
            }
        }

    }
    ```
â–¶ ì¶œë ¥ í™”ë©´ 
![getall](https://user-images.githubusercontent.com/65608960/110940180-d8696780-8379-11eb-8452-d29f0130f149.JPG)

â–¶ DB  
![getallDB](https://user-images.githubusercontent.com/65608960/110940176-d7383a80-8379-11eb-9f59-3cff8a3c21f9.JPG)


- getMember í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
    package com.javateam.jdbc.member.test;

    import java.sql.Date;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    import com.javateam.jdbc.member.domain.MemberVo;

    /**
    * getMember ë©”ì„œë“œ ë‹¨ìœ„ í…Œí¬ìŠ¤ ì¼€ì´ìŠ¤<br>
    * : ê°œë³„ íšŒì› ì •ë³´ ì¡°íšŒ<br><br>
    * 
    * @author migki
    *
    */
    public class GetMemberTest {

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao= MemberDaoImpl.getInstance();
            
            // DBì— ì…ë ¥ëœ ê°’ë“¤ê³¼ VO ê°’ì„ ë¹„êµ
            // ë¹„êµëŒ€ìƒ VO ì¤€ë¹„
            MemberVo member = new MemberVo();
            
            member.setMemberId("java5555");
            member.setMemberPassword("1234");
            member.setMemberNicname("êµ¬ë””ìƒ˜");
            member.setMemberName("í™ê¸¸ë™");
            member.setMemberGender('m');
            member.setMemberEmail("abcd@abcd.com");
            member.setMemberPhone("010-1234-5678");
            member.setMemberBirth(Date.valueOf("2016-02-05"));
            member.setMemberZip("12345");
            member.setMemberAddressBasic("ì„œìš¸ ê¸ˆì²œ ê°€ì‚°");
            member.setMemberAddressDetail("êµ¬ë””ì•„ì¹´ë°ë¯¸");
            // ë‚ ì§œ ì…ë ¥
            member.setMemberJoindate(Date.valueOf("2021-03-12"));
            
            System.out.println(member);
            System.out.println(dao.getMember("java5555"));
            
            System.out.println(member.hashCode());
            System.out.println(dao.getMember("java5555").hashCode());
            
            String result = member.equals(dao.getMember("java5555"))?
                            "íšŒì›ì •ë³´ ì¡°íšŒ ì„±ê³µ" : "íšŒì›ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨";
            
            System.out.println(result);
            
        }

    }
    ```

â–¶ ì¶œë ¥ í™”ë©´ 
![getmember](https://user-images.githubusercontent.com/65608960/110940413-36964a80-837a-11eb-9ccd-3f44588cc0dd.JPG)


- Delete í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
    package com.javateam.jdbc.member.test;

    import java.sql.Date;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    import com.javateam.jdbc.member.domain.MemberVo;

    /**
    * DeleteMember ë©”ì„œë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test Case) <br>
    * : íšŒì›ì •ë³´ ì‚­ì œ í…ŒìŠ¤íŠ¸<br><br>
    * 
    * @author mingki
    *
    */
    public class DeleteMemberTest {

        private static String memberId;

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao = MemberDaoImpl.getInstance();
            

            // UpdateMember í…ŒìŠ¤íŠ¸(true/false)
            String result = dao.deleteMember("java12345") == true ? 
                            "ì‚­ì œ ì„±ê³µ" : "ì‚­ì œ ì‹¤íŒ¨";
            System.out.println("DeleteMember í…ŒìŠ¤íŠ¸ ê²°ê³¼ " + result);
        }

    }
    ```
â–¶ ì¶œë ¥ í™”ë©´ 
![delete](https://user-images.githubusercontent.com/65608960/110940520-634a6200-837a-11eb-8306-70615723ccc7.JPG)

â–¶ DB 
![delete2](https://user-images.githubusercontent.com/65608960/110940516-62193500-837a-11eb-8dfc-bac12f395f8e.JPG)
