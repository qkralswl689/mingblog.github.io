---
layout: post
title: 'Spring in Action - 2.ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œí•˜ê¸°_ 2.3 í¼ ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬í•˜ê¸° ,2.4 ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‘ì—…í•˜ê¸° '
date: 2021-05-16
category: [Spring]
comments: true
---

## ğŸ”· Spring in Action - 2.ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œí•˜ê¸° \_ 2.3 í¼ ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬í•˜ê¸°, 2.4 ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‘ì—…í•˜ê¸°

### âœ” 2.3 í¼ ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬í•˜ê¸°

    - ìŠ¤í”„ë§ì€ ìë°”ì˜ ë¹ˆ ìœ íš¨ì„± ê²€ì‚¬(Bean Validation API)ë¥¼ ì§€ì›í•œë‹¤
    => ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¶”ê°€ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šê³  ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ì„ ì‰½ê²Œ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤
    - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ íš¨ì„± ê²€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í”„ë¡œì íŠ¸ì— ìˆ˜ë¹„ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤
    => ìœ íš¨ì„± ê²€ì‚¬ APIì™€ ì´ APIë¥¼ êµ¬í˜„í•œ Hibernate ì»´í¬ë„ŒíŠ¸ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ì›¹ ìŠ¤íƒ€í„° ì˜ì¡´ì„±ìœ¼ë¡œ ìë™ ì¶”ê°€ë˜ê¸° ë•Œë¬¸

    ğŸˆ ìŠ¤í”„ë§ MVCì— ìœ íš¨ì„± ê²€ì‚¬ ì ìš© ë°©ë²•
    - ìœ íš¨ì„± ê²€ì‚¬í•  í´ë˜ìŠ¤ì— ê²€ì‚¬ ê·œì¹™ ì„ ì–¸
    - ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•´ì•¼í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì— ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œ ë‹¤ëŠ” ê²ƒì„ ì§€ì •
    - ê²€ì‚¬ ì—ëŸ¬ë¥¼ ë³´ì—¬ì£¼ë„ë¡ í¼ ë·°ë¥¼ ìˆ˜ì •

#### âœ” 2.3.1 ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ ì„ ì–¸í•˜ê¸°

- Taco ë„ë©”ì¸ í´ë˜ìŠ¤ì— ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ ì¶”ê°€ ì½”ë“œ

  ```java
  package tacos;

  import lombok.Data;

  import java.util.Date;
  import java.util.List;
  import javax.validation.constraints.NotNull;
  import javax.validation.constraints.Size;

  @Data
  public class Taco {

      private Long id;
      private Date createdAt;

      // @NotNull, @Size() : ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ ì„ ì–¸

      // name ì†ì„±ì—ëŠ” ê°’ì´ null ì´ë©´ X, ìµœì†Œ 5ê°œë¬¸ìì—¬ì•¼ í•œë‹¤
      @NotNull
      @Size(min=5, message="Name must be at lease 5 characters long")
      private String name;

      // jdbcì—°ê²° ìœ„í•´ ë³€ê²½
      @Size(min=1, message="You must choose at lease 1 ingredient")
      private List<String> ingredients;
  }
  ```

- ì£¼ë¬¸ í•„ë“œì˜ ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ ì¶”ê°€ ì½”ë“œ

  ```java
  package tacos;

  import lombok.Data;

  import javax.validation.constraints.Digits;
  import javax.validation.constraints.NotBlank;
  import javax.validation.constraints.Pattern;
  import org.hibernate.validator.constraints.CreditCardNumber;


  import java.util.ArrayList;
  import java.util.Date;
  import java.util.List;

  @Data
  public class Order  {

      @NotBlank(message="Name is required")
      private String deliveryName;

      @NotBlank(message="Street is required")
      private String deliveryStreet;

      @NotBlank(message="City is required")
      private String deliveryCity;

      @NotBlank(message="State is required")
      private String deliveryState;

      @NotBlank(message="Zip is required")
      private String deliveryZip;

      // @CreditCardNumber : ì†ì„±ì˜ ê°’ì´ Luhn ì•Œê³ ë¦¬ì¦˜ ê²€ì‚¬ì— í•©ê²©í•œ ìœ ìš”í•œ ì‹ ìš© ì¹´ë“œ ë²ˆí˜¸ì´ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì„ ì–¸
      @CreditCardNumber(message = "Not a valid credit card number")
      private String ccNumber;

      // Pattern ì–´ë…¸í…Œì´ì…˜ì— ì •ê·œ í‘œí˜„ì‹ì„ ì§€ì •í•˜ì—¬ ì†ì„± ê°’ì´ í•´ë‹¹ í˜•ì‹ì„ ë”°ë¥´ëŠ”ì§€ í™•ì¸
      @Pattern(regexp="^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$", message="Must be formatted MM/YY")
      private String ccExpiration;

      // ì…ë ¥ê°’ì´ ì •í™•í•˜ê²Œ ì„¸ìë¦¬ ìˆ«ìì¸ì§€ ê²€ì‚¬
      @Digits(integer = 3, fraction = 0, message = "Invalid CVV")
      private String ccCVV;

  }
  ```

      â“ @NotBlank ëŒ€ì‹  @NotNullì„ ì“°ë©´ ì•ˆë˜ëŠ”ì§€?
      => @NotNull ì€ ë¹ˆê³µê°„(ìŠ¤í˜ì´ìŠ¤) ì…ë ¥ì´ ê°€ëŠ¥í•˜ì§€ë§Œ @NotBlank ì€ ë¹ˆê³µê°„(ìŠ¤í˜ì´ìŠ¤) ì…ë ¥ì´ ë¶ˆê°€í•˜ë‹¤ -> ìŠ¤í˜ì´ìŠ¤ ì…ë ¥ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ @NotBlank ì„ ì‚¬ìš©!

#### âœ” 2.3.2 í¼ê³¼ ë°”ì¸ë”©ë  ë•Œ ìœ íš¨ì„± ê²€ì‚¬ ìˆ˜í–‰í•˜ê¸°

- ì œì¶œëœ Tacoì˜ ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€ ì½”ë“œ

  ```java
  package tacos.web;

  import java.util.ArrayList;

  import java.util.List;
  import java.util.stream.Collectors;

  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.stereotype.Controller;
  import org.springframework.ui.Model;
  import org.springframework.web.bind.annotation.*;

  import lombok.extern.slf4j.Slf4j;
  import tacos.Taco;
  import tacos.Ingredient;
  import tacos.Ingredient.Type;
  import javax.validation.Valid;
  import org.springframework.validation.Errors;
  import tacos.data.IngredientRepository;
  import tacos.data.TacoRepository;


  @Slf4j

  // @Controller : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‹ë³„ë˜ê²Œ í•˜ë©° ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰ì„ í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„
  // => ìŠ¤í”„ë§ì´ í•´ë‹¹í´ë˜ìŠ¤ë¥¼ ì°¾ì€í›„ ìŠ¤í”„ë§ APPì»´í…ìŠ¤íŠ¸ì˜ ë¹ˆ(Bean)ìœ¼ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ ìƒì„±í•œë‹¤
  @Controller

  // @RequestMapping : í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì²˜ë¦¬í•˜ëŠ” ìš”ì²­ì˜ ì¢…ë¥˜
  // ìš”ì²­ ê²½ë¡œê°€ disign ì¸ HTTP GET ìš”ì²­ ì²˜ë¦¬
  @RequestMapping("/design")

  // Orderì˜ ë‹¤ìˆ˜ì˜ HTTP ìš”ì²­ì— ê±¸ì²˜ ì¡´ì¬ í•´ì•¼í•œë‹¤ => ë‹¤ìˆ˜ì˜ íƒ€ì½”ë¥¼ ìƒì„±í•˜ê³  í•˜ë‚˜ì˜ ì£¼ë¬¸ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´
  // í´ë˜ìŠ¤ ìˆ˜ì¦Œì˜ @SessionAttributes ì„ ì£¼ë¬¸ê³¼ ê°™ì€ ëª¨ë¸ ê°ì²´ì— ì§€ì • => ì„¸ì…˜ì—ì„œ ê³„ì† ë³´ì¡´ë˜ë©´ì„œ ë‹¤ìˆ˜ì˜ ìš”ì²­ì— ê±¸ì³ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤
  @SessionAttributes("order")
  public class DesignTacoController {


      // /design ê²½ë¡œì˜ POST ìš”ì²­ì„ ì²˜ë¦¬ => taco ë¥¼ ë””ìì¸ í•˜ëŠ” ì‚¬ìš©ìê°€ ì œì¶œí•œ ê²ƒì„ ì—¬ê¸°ì—ì„œ ì²˜ë¦¬í•œë‹¤
      @PostMapping

      // processDesign() ë©”ì„œë“œì—ì„œëŠ” taco ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ì–´ë–¤ ê²ƒì´ë“  ì›í•˜ëŠ” ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤
      // @Valid : ì œì¶œëœ taco ê°ì²´ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰ í•˜ë¼ê³  ìŠ¤í”„ë§ MVC ì— ì•Œë ¤ì¤€ë‹¤

      public String processDesign(@Valid Taco design, Errors errors){
          // Errors ê°ì²´ì˜ hsErrors() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ê²€ì‚¬ ì—ëŸ¬ê°€ ìˆëŠ”ì§€ í™•ì¸
          // ì—ëŸ¬ê°€ ìˆìœ¼ë©´ taco ì˜ ì²˜ë¦¬ë¥¼ ì¤‘ì§€í•˜ê³  "disign" ë·° ì´ë¦„ì„ ë°˜í™˜í•˜ì—¬ í¼ì´ ë‹¤ì‹œ ë³´ì´ê²Œ í•œë‹¤
          if(errors.hasErrors()){
              return "design";
          }
          log.info("Processing design: " + design);

          // redirect : processDesign()ì˜ ì‹¤í–‰ì´ ëë‚œ í›„ ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ê°€ /orders/current ìƒëŒ€ ê²½ë¡œë¡œ ì¬ì ‘ì†ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚¸ë‹¤
          return "redirect:/orders/current";
      }
  }
  ```

      â“ @Valid : ì œì¶œëœ taco ê°ì²´ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰ í•˜ë¼ê³  ìŠ¤í”„ë§ MVC ì— ì•Œë ¤ì¤€ë‹¤ ëŠ”ê²Œ ë¬´ìŠ¨ëœ»?
      => MVC ì— ë¶™ì–´ìˆëŠ” ì–´ë…¸í…Œì´ì…˜ ë“¤ì—ê²Œ ì•Œë ¤ì£¼ëŠ”ê²ƒ ê°™ë‹¤

- ì œì¶œëœ Orderì˜ ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€ ì½”ë“œ

  ```java
  package tacos.web;

  import lombok.extern.slf4j.Slf4j;
  import org.springframework.stereotype.Controller;
  import org.springframework.ui.Model;
  import org.springframework.validation.Errors;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.PostMapping;
  import org.springframework.web.bind.annotation.RequestMapping;
  import tacos.Order;
  import javax.validation.Valid;

  @Slf4j
  @Controller
  // @RequestMapping : /orders ë¡œ ì‹œì‘ë˜ëŠ” ê²½ë¡œì˜ ìš”ì²­ì„ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ìš”ì²­ ì²˜ë¦¬ ë©”ì„œë“œê°€ ì²˜ë¦¬í•œë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ì• ë…¸í…Œì´ì…˜
  @RequestMapping("/orders")
  @SessionAttributes("order")
  public class OrderController {

      // Order ìœ íš¨ì„± ê²€ì‚¬
      @PostMapping

        public String processOrder(@Valid Order order, Errors errors) {
          if (errors.hasErrors()) {

              // orderForm ì„ ë¦¬í„´í•œë‹¤
              return "orderForm";
          }

          log.info("Order submitted: " + order);

          return "redirect:/";
      }
  }

  ```

#### âœ” 2.3.3 ìœ íš¨ì„± ê²€ì‚¬ ì—ëŸ¬ ë³´ì—¬ì£¼ê¸°

- ì£¼ë¬¸ í¼ì˜ ëª¨ë“  í•„ë“œì— span ì¶”ê°€ ì½”ë“œ
  ```html
  <span class="validationError" th:if="${#fields.hasErrors('ccCVV')}" th:errors="*{ccCVV}">CC Num Error</span>
  ```

â–¶ ìœ íš¨ì„±ê²€ì‚¬ ì¶œë ¥
![ìœ íš¨ì„±ê²€ì‚¬](https://user-images.githubusercontent.com/65608960/118386103-d6f53d80-b64f-11eb-9d4c-774e75cf1f48.gif)

### âœ” 2.4 ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‘ì—…í•˜ê¸°

    - ë·°ì— ìš”ì²­ì„ ì „ë‹¬í•˜ëŠ” ì¼ë§Œ í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬(ë·° ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ ì„ ì–¸í•˜ëŠ” ë°©ë²•

- ë·° ì»¨íŠ¸ë¡¤ëŸ¬ ì„ ì–¸ ì½”ë“œ

  ```java
  package tacos.web;

  import org.springframework.context.annotation.Configuration;
  import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
  import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

  // ë·° ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—­í• ì„ìˆ˜í–‰í•˜ëŠ” êµ¬ì„± í´ë˜ìŠ¤
  // WebMvcConfigurer : ìŠ¤í”„ë§ MVCë¥¼ êµ¬ì„±í•˜ëŠ” ë©”ì„œë“œë¥¼ ì •ì˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
  @Configuration
  public class WebConfig implements WebMvcConfigurer {

      @Override
      // addViewControllers()ëŠ” í•˜ë‚˜ ì´ìƒì˜ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”
      // ViewControllerRegistry ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤
      public void addViewControllers(ViewControllerRegistry registry) {
          // ë·° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ GET ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê²½ë¡œì¸ "/" ë¥¼ ì¸ìë¡œ ì „ë‹¬í•´
          // addViewController()ë¥¼ í˜¸ì¶œí•œë‹¤ => ViewControllerRegistry ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤
          // setViewName("home") : "/" ê²½ë¡œì˜ ìš”ì²­ì´ ì „ë‹¬ë˜ì–´ì•¼ í•˜ëŠ” ë·°ë¡œ home ì„ ì§€ì •
          registry.addViewController("/").setViewName("home");
      }
  }
  ```

      â“ WebMvcConfigurer ì¸í„°í˜ì´ìŠ¤ëŠ” ì™œ ë©”ì„œë“œ í•˜ë‚˜ë§Œ ì„ íƒí•´ì„œ êµ¬í˜„ì´ ê°€ëŠ¥í• ê¹Œ?
      => ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œ ì•ì— defualt ê°€ ë¶™ì–´ìˆìœ¼ë©´ ì„ íƒì ã„´ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤

### âœ” 2. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œí•˜ê¸° ìš”ì•½

    - ìŠ¤í”„ë§ì€ ìŠ¤í”„ë§ MVCë¼ëŠ” ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì œê³µ -> ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì›¹ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì— ì‚¬ìš©
    - ìŠ¤í”„ë§ MVCëŠ” ì• ë…¸í…Œì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ê³  @RequestMapping, @GetMapping, @PostMapping ì„ ì‚¬ìš©í•´ ìš”ì²­ ì²˜ë¦¬ ë©”ì„œë“œë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.
    - ëŒ€ë¶€ë¶„ ìš”ì²­ ì²˜ë¦¬ ë©”ì„œë“œë“¤ì€ ë§ˆì§€ë§‰ì— Thymeleaf í…œí”Œë¦¿ê³¼ ê°™ì€ ë…¼ë¦¬ ë·° ì´ë¦„ì„ ë°˜í™˜
    => ëª¨ë¸ ë°ì´í„°ì™€ í•¨ê»˜ í•´ë‹¹ ìš”ì²­ì„ ì „ë‹¬í•˜ê¸° ìœ„í•´
    - ìŠ¤í”„ë§ MVCëŠ” ìë°” ë¹ˆ ìœ íš¨ì„± ê²€ì‚¬ API ì™€ Hibernate Validator ë“± ìœ íš¨ì„± ê²€ì‚¬ API êµ¬í˜„ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§€ì›í•œë‹¤.
    - ëª¨ë¸ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ëŠ” HTTP GET ìš”ì²­ì„ ì²˜ë¦¬í•  ë•ŒëŠ” ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
    - Thymeleafì— ì¶”ê°€í•´ ìŠ¤í”„ë§ì€ ë‹¤ì–‘í•œ ë·° í…œí”Œë¦¿ì„ ì§€ì›í•œë‹¤
