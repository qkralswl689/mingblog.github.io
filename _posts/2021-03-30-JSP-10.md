---
layout: post
title: "JSP - JSP 2.3 & Servlet3.1 - JavaMail(ë©”ì¼ì „ì†¡), DBì—°ê²°, DBì—°ê²°í•˜ì—¬ íšŒì›ê´€ë¦¬ "
date: 2021-03-30
category : [JSP]
comments: true
---

## ğŸ”· JSP 2.3 & Servlet3.1 -  JavaMail(ë©”ì¼ì „ì†¡), DBì—°ê²°, DBì—°ê²°í•˜ì—¬ íšŒì›ê´€ë¦¬ 

### âœ” JavaMail(ë©”ì¼ì „ì†¡)

    - JavaMail : Pop3, SMTP ë“±ì˜ ë©”ì¼ í”„ë¡œí† ì½œì„ ì´ìš©í•˜ì—¬ ë©”ì¼ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë„ë¡ ì œê³µí•´ì£¼ëŠ” API

- ì½”ë“œ : ë©”ì¼ë³´ë‚´ê¸°(form) 
    ```html
    <!doctype html>
    <html lang="ko">
    <head>
    <title>ìë°” ë©”ì¼ ë³´ë‚´ê¸° í¼</title>
    <meta charset="UTF-8">
    <style>
    table {
        width:600px;
        margin:auto;
    }

    h1 {
        text-align:center;
    }

    td {
        border:1px solid gray;
        padding:10px;
    }
    </style>
    </head>
    <body>

        <form action="mailSend.jsp" method="post">
            
            <h1>ìë°”ë©”ì¼ ë³´ë‚´ê¸°</h1>
            
            <table>
                <tr>
                    <td>ë³´ë‚´ëŠ” ì‚¬ëŒ ë©”ì¼ : </td>
                    <td><input type="text" name="sender"></td>
                </tr>
                <tr>
                    <td>ë°›ëŠ” ì‚¬ëŒ ë©”ì¼ : </td>
                    <td><input type="text" name="receiver"></td>
                </tr>
                <tr>
                    <td>ì œëª© : </td>
                    <td><input type="text" name="subject"></td>
                </tr>
                <tr>
                    <td>ë‚´ìš© : </td>
                    <td><textarea name="content" cols="40" rows="20"></textarea></td>
                </tr>
                <tr>
                    <td align=center colspan=2>
                        <input type="submit" value="ë³´ë‚´ê¸°">
                    </td>
                </tr>
            </table>
        </form>
        
    </body>
    </html>
    ```

- jspì½”ë“œ (ì‹œìŠ¤í…œì„¤ì •)
    ```js
    <%@ page language="java" contentType="text/html; charset=UTF-8"%>
    <%@ page import="java.util.*" %>
    <%@ page import="javax.mail.*" %>
    <%@ page import="javax.mail.internet.*" %>
    <%@ page import="example.*" %>
    <%
        
        
        // í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ì—ì„œ ë©”ì¼ ì „ì†¡ì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì „ì†¡ë˜ì–´ ì˜¨ íŒŒë¼ë¯¸í„° ê°’ë“¤ì€ ë°›ëŠ” ë¶€ë¶„
        // ìë°” ë©”ì¼ ë³´ë‚´ê¸° í¼ì—ì„œ ì…ë ¥í•œ í•œê¸€ ì •ë³´ê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ ì„¤ì •
        request.setCharacterEncoding("UTF-8");
        // ë©”ì¼ ì†¡ì‹ ì
        String sender = request.getParameter("sender");
        // ë©”ì¼ ìˆ˜ì‹ ì
        String receiver = request.getParameter("receiver");
        // ë©”ì¼ ì œëª©
        String subject = request.getParameter("subject");
        // ë©”ì¼ ë‚´ìš©
        String content = request.getParameter("content");
        
        out.println("ì†¡ì‹ ì : " + sender + "<br>");
        out.println("ìˆ˜ì‹ ì : " + receiver + "<br>");
        out.println("ì œëª© : " + subject + "<br>");
        out.println("ë‚´ìš© : " + content + "<br>");

        // ë©”ì¼ ì†¡ì‹ ì
        String id = "idì…ë ¥";
        String pw = "pwì…ë ¥";

        // ì‹œìŠ¤í…œ ì„¤ì • => ì„œë²„ ì •ë³´ë¥¼ Propertiesê°ì²´ì— ì €ì¥í•œë‹¤
        // https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#getProperties--
        Properties p = System.getProperties();
        // SMTP ì‚¬ìš© ì—¬ë¶€ ì„¤ì •
        p.put("mail.smtp.starttls.enable", "true");
        // SMTP ì„œë²„ ì„¤ì • : smtp.naver.com ì„œë²„ ëª…
        p.put("mail.smtp.host", "smtp.naver.com");
        // SMTP ì¸ì¦ ì—¬ë¶€ ì„¤ì •
        p.put("mail.smtp.auth", "true");
        // STMP í¬íŠ¸(port) ì„¤ì •
        p.put("mail.smtp.port", "587");

        // ë„¤ì´ë²„(naver) ID/PW ì¸ì¦ -> ì¸ì¦ ì •ë³´ ìƒì„±
        Authenticator auth = new MyMailAuthenticator(id, pw);
        // ë©”ì¼ ì¸ì¦ ì„¸ì…˜
        Session mailSession = Session.getDefaultInstance(p, auth);
        // ë©”ì¼ ë©”ì‹œì§€ ê°ì²´
        MimeMessage msg = new MimeMessage(mailSession);

        try {
            // ë©”ì¼ ì†¡ë¶€ ë‚ ì§œ ì„¤ì •
            msg.setSentDate(new Date());
            InternetAddress from = new InternetAddress();
                    
            // ì†¡ì‹ ì ë©”ì¼
            from = new InternetAddress(sender);
            msg.setFrom(from);

            // ìˆ˜ì‹ ì ë©”ì¼
            InternetAddress to = new InternetAddress(receiver);
            msg.setRecipient(Message.RecipientType.TO, to);

            // ë©”ì¼ ë‚´ìš© ë° ì¸ì½”ë”© ë°©ì‹(encoding), MIME type(text/html) ë“±ë¡
            // ë©”ì¼ ì œëª© ì„¤ì •
            msg.setSubject(subject, "UTF-8");
            // ë©”ì¼ ë‚´ìš© ì„¤ì •
            msg.setText(content, "UTF-8");
            // ë©”ì¼ MIME type ì„¤ì •
            msg.setHeader("content-Type", "text/html");

            // ë©”ì¼ ì „ì†¡
            javax.mail.Transport.send(msg);
            
            out.println("ë©”ì¼ ì†¡ë¶€");
            
        } catch (AddressException e) {
            System.err.println("AddressException : " + e);
            e.printStackTrace();
        } catch (MessagingException e){
            System.err.println("MessagingException : " + e);
            e.printStackTrace();
        } // try
    %>
    ```
- ì¸ì¦ì½”ë“œ(id,pw ì¸ì¦)
    ```java
    package example;

    import javax.mail.Authenticator;
    import javax.mail.PasswordAuthentication;

    /**
    * ë©”ì¼ ì¸ì¦(ì•„ì´ë””/íŒ¨ì“°ì›Œë“œ) í´ë˜ìŠ¤
    * 
    * @author javateam
    *
    */
    public class MyMailAuthenticator extends Authenticator {
            
        PasswordAuthentication account;
    
        // MyMailAuthenticator : PasswordAuthentication ê°ì²´ ìƒì„±í›„ id,pwì •ë³´ ë°›ëŠ”ë‹¤
        public MyMailAuthenticator(String id, String pw){
            account = new PasswordAuthentication(id, pw);
        }
    
        // Authentication êµ¬í˜„ì‹œ ë°˜ë“œì‹œ êµ¬í˜„í•´ ì£¼ì–´ì•¼ í•˜ëŠ” ë©”ì†Œë“œ
        public PasswordAuthentication getPasswordAuthentication(){
            return account;
        }    
    }
    ```
- ë©”ì¼ì „ì†¡ ì½”ë“œ
    ```java
    package example;

    import javax.mail.*;
    import javax.mail.internet.*;
    import java.util.Date;
    import java.util.Properties;

    public class MailSend {
        
        public static void main(String[] args) {
            
            // ë„¤ì´ë²„(naver)ì˜ ì•„ì´ë””/íŒ¨ì“°ì›Œë“œë¥¼ ì™¸ë¶€ ì¸ìë¥¼ í†µí•´ì„œ ì…ë ¥í•©ë‹ˆë‹¤.
            String id = args[0].trim();
            String pw = args[1].trim();
            
            // ì‹œìŠ¤í…œ ì„¤ì •
            Properties p = System.getProperties();
            // SMTP ì‚¬ìš© ì—¬ë¶€ ì„¤ì •
            p.put("mail.smtp.starttls.enable", "true");
            // SMTP ì„œë²„ ì„¤ì •
            p.put("mail.smtp.host", "smtp.naver.com");
            // SMTP ì¸ì¦ ì—¬ë¶€ ì„¤ì •
            p.put("mail.smtp.auth", "true");
            // STMP í¬íŠ¸(port) ì„¤ì •
            p.put("mail.smtp.port", "587");
    
            // ë„¤ì´ë²„(naver) ID/PW ì¸ì¦
            Authenticator auth = new MyMailAuthenticator(id, pw);
            // ë©”ì¼ ì¸ì¦ ì„¸ì…˜
            Session session = Session.getDefaultInstance(p, auth);
            // ë©”ì¼ ë©”ì‹œì§€ ê°ì²´
            MimeMessage msg = new MimeMessage(session);
    
            try {
                // ë©”ì¼ ì†¡ë¶€ ë‚ ì§œ ì„¤ì •
                msg.setSentDate(new Date());
                InternetAddress from = new InternetAddress();
                
                // ì†¡ì‹ ì ë©”ì¼
                from = new InternetAddress("sender<alswl689@naver.com>");
                msg.setFrom(from);
    
                // ìˆ˜ì‹ ì ë©”ì¼
                InternetAddress to = new InternetAddress("alswl689@naver.com");
                msg.setRecipient(Message.RecipientType.TO, to);
    
                // ë©”ì¼ ë‚´ìš© ë° ì¸ì½”ë”© ë°©ì‹(encoding), MIME type(text/html) ë“±ë¡
                // ë©”ì¼ ì œëª© ì„¤ì •
                msg.setSubject("ë©”ì¼ ì œëª©ì…ë‹ˆë‹¤.", "UTF-8");
                // ë©”ì¼ ë‚´ìš© ì„¤ì •
                msg.setText("ë©”ì¼ ë‚´ìš©ì…ë‹ˆë‹¤.", "UTF-8");
                // ë©”ì¼ MIME type ì„¤ì •
                msg.setHeader("content-Type", "text/html");
    
                // ë©”ì¼ ì „ì†¡
                javax.mail.Transport.send(msg);
                
            } catch (AddressException e) {
                System.err.println("AddressException : " + e);
                e.printStackTrace();
            } catch (MessagingException e){
                System.err.println("MessagingException : " + e);
                e.printStackTrace();
            }
            
        }
        
    }
    ```
   
â–¶ ì¶œë ¥í™”ë©´(ë©”ì¼ì „ì†¡ ë‚´ì—­ ì…ë ¥)
![ë©”ì¼ë³´ë‚´ê¸°í¼](https://user-images.githubusercontent.com/65608960/112991808-82caf280-91a2-11eb-9742-18baf9972ea5.JPG)

â–¶ ì¶œë ¥í™”ë©´(ë©”ì¼ì „ì†¡ ì…ë ¥í›„ ì „ì†¡)
![ë©”ì¼ì „ì†¡í›„](https://user-images.githubusercontent.com/65608960/112991804-8199c580-91a2-11eb-9119-3c95f6ee7616.JPG)

â–¶ ì¶œë ¥í™”ë©´(ë©”ì¼ìˆ˜ì‹  í™•ì¸)
![ë°›ì€ë©”ì¼í•¨](https://user-images.githubusercontent.com/65608960/112991813-82caf280-91a2-11eb-8f14-e2b6ee3d754c.JPG)


### âœ” DBì—°ê²°

- context.xmlì½”ë“œ
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <Context>
        <!-- oracle -->
        <Resource name="jdbc/xe"
            auth="Container"
            type="javax.sql.DataSource"
            driverClassName="oracle.jdbc.OracleDriver"
            factory="org.apache.tomcat.dbcp.dbcp2.BasicDataSourceFactory"
            url="jdbc:oracle:thin:@localhost:1521:xe"
            username="hr"
            password="hr" 
            maxActive="20" 
            maxIdle="10"
            maxWait="-1" />
            
        <!-- maria db -->
        <Resource name="jdbc/bigdb"
            auth="Container"
            type="javax.sql.DataSource"
            driverClassName="org.mariadb.jdbc.Driver"
            factory="org.apache.tomcat.dbcp.dbcp2.BasicDataSourceFactory"
            url="jdbc:mariadb://localhost:3306/bigdb"
            username="java"
            password="java" 
            maxActive="20" 
            maxIdle="10"
            maxWait="-1" />
    </Context>
    ```

- Oracle ì—°ê²°
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
    <%@ page import="java.sql.*" %>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%
        String id = "";
        
        Connection con =null;
        PreparedStatement pstmt=null;
        ResultSet rs=null;
        
        try {
            Context initContext = new InitialContext();
            
            // ì°¸ê³ ) http://tomcat.apache.org/tomcat-9.0-doc/jndi-resources-howto.html

            // howto-1)
            // Context envCtx = (Context)initContext.lookup("java:comp/env");
            // DataSource ds = (DataSource)envCtx.lookup("jdbc/xe");
        
            // howto-2)
            DataSource ds = (DataSource)initContext.lookup("java:/comp/env/jdbc/xe");
            
            con=ds.getConnection();
            
            String sql ="SELECT employee_id FROM employees";
            pstmt = con.prepareStatement(sql);
            rs = pstmt.executeQuery();
            
            while (rs.next()) {						
                id = rs.getString(1);		
                out.println(id+" ");
            }
                    
        } catch(Exception e) {
            System.out.println(e.getMessage());
            e.printStackTrace();
        } finally {
            rs.close();
            pstmt.close();
            con.close();
        }
    %>    
    <!DOCTYPE html>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>DBCP testing</title>
    </head>
    <body>
    </body>
    </html>
    ```
- MariaDBì—°ê²°
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
    <%@ page import="java.sql.*" %>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%
        String id = "";
        
        Connection con =null;
        PreparedStatement pstmt=null;
        ResultSet rs=null;
        
        try {
            Context initContext = new InitialContext();
            
            // ì°¸ê³ ) http://tomcat.apache.org/tomcat-9.0-doc/jndi-resources-howto.html
            // mariaDB Connector/J ì‚¬ìš©ë²• 
            // : https://mariadb.com/kb/en/about-mariadb-connector-j/#using-drivermanager

            // howto-1)
            // Context envCtx = (Context)initContext.lookup("java:comp/env");
            // DataSource ds = (DataSource)envCtx.lookup("jdbc/xe");
        
            // howto-2)
            DataSource ds = (DataSource)initContext.lookup("java:/comp/env/jdbc/bigdb");
            
            con=ds.getConnection();
            
            String sql ="SELECT deptno FROM dept";
            
            pstmt = con.prepareStatement(sql);
            rs = pstmt.executeQuery();
            
            while (rs.next()) {						
                id = rs.getString(1);		
                out.println(id+" ");
            }
                    
        } catch(Exception e) {
            System.out.println(e.getMessage());
            e.printStackTrace();
        } finally {
            rs.close();
            pstmt.close();
            con.close();
        }
    %>    
    <!DOCTYPE html>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>DBCP testing</title>
    </head>
    <body>
    </body>
    </html>
    ```

### âœ” DBì—°ê²° í•˜ì—¬ íšŒì›ê´€ë¦¬ í”„ë¡œê·¸ë¨

- ë¡œê·¸ì¸ ì½”ë“œ(FORM)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <!DOCTYPE html>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>íšŒì› ê´€ë¦¬ ì‹œìŠ¤í…œ ë¡œê·¸ì¸ í˜ì´ì§€</title>
    <style>
        table{
            margin : auto;
            width : 400px;
            border : 1px solid gray;
            text-align: center;
        }
        .td_title{
            font-weight: bold;
            font-size: x-large;
        }
    </style>
    </head>
    <body>
    <!-- formì˜ì—­ì— ìˆëŠ” ë°ì´í„°ê°€ ì „ì†¡ë˜ëŠ” ìš”ì²­ URLì„   loginProcess.jsp í˜ì´ì§€ë¡œ ì§€ì •-->
    <form name="loginform" action="loginProcess.jsp" method="post">
    <table>
        <tr>
            <td colspan="2" class = "td_title">
                ë¡œê·¸ì¸ í˜ì´ì§€
            </td>
        </tr>
        <tr>
            <!--ë¡œê·¸ì¸ì— ì‚¬ìš©í•  IDì…ë ¥ ì–‘ì‹  -->
            <td><label for = "id">ì•„ì´ë”” : </label></td>
            <td><input type="text" name="id" id = "id"/></td>
        </tr>
        <tr>
            <!--ë¡œê·¸ì¸ì— ì‚¬ìš©í•  PWì…ë ¥ ì–‘ì‹  -->
            <td><label for = "pass">ë¹„ë°€ë²ˆí˜¸ : </label></td>
            <td><input type="password" name="pass" id = "pass"/></td>
        </tr>
        <tr>
            <td colspan="2">
                <!-- ë¡œê·¸ì¸ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ jsë¥¼ ì‚¬ìš©í•´ loginform  ê°ì²´ì˜ submit() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬
                        loginProcess.jsp í˜ì´ì§€ë¡œ ìš”ì²­í•œë‹¤ -->
                <a href="javascript:loginform.submit()">ë¡œê·¸ì¸</a>&nbsp;&nbsp;
                <!-- íšŒì›ê°€ì… í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ë©´ joinForm.jsp ë¡œ ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ë§í¬ë¥¼ ì§€ì •  -->
                <a href="joinForm.jsp">íšŒì›ê°€ì…</a>
            </td>
        </tr>
    </table>
    </form>
    </body>
    </html>
    ```
â–¶ ì¶œë ¥í™”ë©´(ì²« í™”ë©´)
![ë¡œê·¸ì¸](https://user-images.githubusercontent.com/65608960/112993640-629c3300-91a4-11eb-8d7f-f85b3127b87b.JPG)


- íšŒì›ê°€ì… ì½”ë“œ(FORM)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <!DOCTYPE html>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>íšŒì›ê´€ë¦¬ ì‹œìŠ¤í…œ íšŒì›ê°€ì… í˜ì´ì§€</title>
    <style>
        table{
            margin : auto;
            width : 400px;
            border : 1px solid gray;
            text-align: center;
        }
        .td_title{
            font-weight: bold;
            font-size: x-large;
        }
    </style>
    </head>
    <body>
    <form name ="joinform" action = "joinProcess.jsp" method="post" />
    <table border=1>
        <tr>
            <td colspan="2" class = "td_title">
                íšŒì›ê°€ì… í˜ì´ì§€
            </td>
        </tr>
        <tr>
            <td><label for = "id">ì•„ì´ë”” : </label></td>
            <td><input type="text" name="id" id = "id"/></td>
        </tr>
        <tr>
            <td><label for = "pass">ë¹„ë°€ë²ˆí˜¸ : </label></td>
            <td><input type="password" name="pass" id = "pass"/></td>
        </tr>
        <tr>
            <td><label for = "name">ì´ë¦„ : </label></td>
            <td><input type="text" name="name" id = "name"/></td>
        </tr>
        <tr>
            <td><label for = "age">ë‚˜ì´ : </label></td>
            <td><input type="text" name="age" id = "age"/>
            </td>
        </tr>
        <tr>
            <td><label for = "gender1"></label>ì„±ë³„ : </td>
            <td>
                <input type="radio" name="gender" value="ë‚¨" checked id = "gender1"/>ë‚¨ì
                <input type="radio" name="gender" value="ì—¬" id = "gender2"/>ì—¬ì
            </td>
        </tr>
        <tr>
            <td><label for = "email">ì´ë©”ì¼ ì£¼ì†Œ : </label></td>
            <td><input type="text" name="email" id = "email"/></td>
        </tr>
        <tr>
            <td colspan="2">
                <!-- íšŒì›ê°€ì… ë§í¬ í´ë¦­í•˜ë©´ jsë¥¼ ì´ìš©í•´ joinformê°ì²´ì˜ submit()  ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬
                        joinProcess.jspí˜ì´ì§€ë¡œ ìš”ì²­í•œë‹¤ -->
                <a href="javascript:joinform.submit()">íšŒì›ê°€ì…</a>&nbsp;&nbsp;
                <a href="javascript:joinform.reset()">ë‹¤ì‹œì‘ì„±</a>
            </td>
        </tr>
    </table>
    </form>
    </body>
    </html>
    ```

- íšŒì›ê°€ì… ì½”ë“œ(Process)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%@ page import="java.sql.*"%>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%

        request.setCharacterEncoding("UTF-8");

        String id = request.getParameter("id");
        String pass = request.getParameter("pass");
        String name = request.getParameter("name");
        int age = Integer.parseInt(request.getParameter("age"));
        String gender = request.getParameter("gender");
        String email = request.getParameter("email");
        
        Connection con = null;
        PreparedStatement pstmt = null;
        
        try{
            
            Context init = new InitialContext();
            
            DataSource ds = (DataSource) init.lookup("java:/comp/env/jdbc/scott");
            con = ds.getConnection();
            
            pstmt= con.prepareStatement("INSERT INTO member VALUES (?,?,?,?,?,?)");
            pstmt.setString(1,id);
            pstmt.setString(2,pass);
            pstmt.setString(3,name);
            pstmt.setInt(4,age);
            pstmt.setString(5,gender);
            pstmt.setString(6,email);
            
            int result = pstmt.executeUpdate(); // ë°ì´í„° ì‚½ì… ì„±ê³µì—¬ë¶€ 1, 0 ìœ¼ë¡œ ì „ë‹¬
            
            if(result !=0){ // ì„±ê³µì‹œ
                out.println("<script>");
                out.println("location.href='loginForm.jsp'"); // loginForm.jspë¡œ ì´ë™
                out.println("</script>");
            }else{ // ì‹¤íŒ¨ì‹œ
                out.println("<script>");
                out.println("location.href='joinForm.jsp'");// joinForm.jspë¡œ ì´ë™
                out.println("</script>");	
            }
            
        }catch(Exception e){
            e.printStackTrace();
        }finally{
            try{// ìì›ë°˜ë‚©
                pstmt.close();
                con.close();
            }
            catch(Exception e){
                e.printStackTrace();
            }
        }
        
    %>
    ```
â–¶ ì¶œë ¥í™”ë©´(íšŒì›ê°€ì…)
![adminê°€ì…](https://user-images.githubusercontent.com/65608960/112993639-62039c80-91a4-11eb-9c48-974e8d65b75d.JPG)

- ë¡œê·¸ì¸ ì½”ë“œ(Process)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%@ page import = "java.sql.*" %>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>

    <%
        String id = request.getParameter("id");
        String pass = request.getParameter("pass");
        
        Connection con = null; // DBì—°ê²°
        PreparedStatement pstmt =null; // SQLì²˜ë¦¬ ê°ì²´ 
        ResultSet rs = null; // ê²°ê³¼ì…‹ ê°ì²´
        
        try{
        Context init = new InitialContext(); // JNDI ë„¤ì´ë° ë°©ì‹ : ì™¸ë¶€ê°ì²´ë¥¼ ì´ìš©í•˜ê¸°ìœ„í•œ ê¸°ìˆ 
        DataSource ds = (DataSource) init.lookup("java:/comp/env/jdbc/scott"); // lookup :ì°¸ê³ 
        con = ds.getConnection();//lookupí•œ dbì—°ê²°
        
        pstmt=con.prepareStatement("SELECT * FROM member WHERE id=?"); //SQL ë¬¸ ì‘ì„±
        pstmt.setString(1,id); // ? ì— ë“¤ì–´ê°ˆ ì¸ì idë¡œ ì§€ì •
        rs=pstmt.executeQuery();
        
        if(rs.next()){ // db ìˆœì„œëŒ€ë¡œ íƒìƒ‰
            if(pass.equals(rs.getString("pass"))){//dbì—ì„œ ê°€ì ¸ì˜¨ ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ë°›ì€ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ë‹¤ë©´
                session.setAttribute("id",id); // sessionì˜ì—­ì— ì…ë ¥ë°›ì€ id ì´ë¦„ì˜ ì†ì„± ê°’ì„ ìƒì„±
                
                out.println("<script>");
                out.println("location.href='main.jsp'");//main.jspí˜ì´ì§€ë¡œ ì´ë™í•œë‹¤
                out.println("</script>");
            }
        }else{ // ì¼ì¹˜í•˜ì§€ ì•Šë‹¤ë©´
            out.println("<script>"); 
            out.println("location.href='loginForm.jsp'"); // loginForm.jsp í˜ì´ì§€ë„ ì´ë™í•œë‹¤
            out.println("</script>");
        }
            
        }catch(Exception e){ // ì˜ˆì™¸ì²˜ë¦¬
            e.printStackTrace();
        }finally{
            try{ // ìì›ë°˜ë‚©
                rs.close();
                pstmt.close();
                con.close();
            }
            catch(Exception e){ // ìì›ë°˜ë‚©ì‹œ ì˜ˆì™¸ì²˜ë¦¬
                e.printStackTrace();
            }
        }
    %>
    ```

- íšŒì›ê´€ë¦¬ ì‹œìŠ¤í…œ ì½”ë“œ(main)
    ```jsp
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%
        String id = null;

        //ì…ë ¥ë°›ì€ idê°’ì´ ì„¸ì…˜ì˜ idì— ë“±ë¡ë˜ì–´ìˆëŠ” ìƒíƒœë¼ë©´ 
        if(session.getAttribute("id")!=null){ 
            id=(String)session.getAttribute("id"); //ì„¸ì…˜ì— ì €ì¥ëœ Idê°’ì„ ë³€ìˆ˜ì— ì €ì¥í•œë‹¤
        }else{//ì•„ë‹ˆë©´
            out.println("<script>");
            out.println("location.href='loginForm.jsp'");
            out.println("</script>");
        }
    %>

    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>íšŒì›ê´€ë¦¬ ì‹œìŠ¤í…œ ë©”ì¸ í˜ì´ì§€</title>
    </head>
    <body>
    <h3><%=id %> ë¡œ ë¡œê·¸ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.</h3>
    <%if(id.equals("admin")){ %>
    <a href="member_list.jsp">ê´€ë¦¬ìëª¨ë“œ ì ‘ì†(íšŒì› ëª©ë¡ ë³´ê¸°)</a>
    <% }%>
    </body>
    </html>
    ```
â–¶ ì¶œë ¥í™”ë©´(admin ë¡œê·¸ì¸)
![adminë¡œê·¸ì¸](https://user-images.githubusercontent.com/65608960/112993638-62039c80-91a4-11eb-89f1-432d7dddfc42.JPG)
![adminë¡œê·¸ì¸2](https://user-images.githubusercontent.com/65608960/112993634-616b0600-91a4-11eb-9738-24d7bb81c9d1.JPG)


â–¶ ì¶œë ¥í™”ë©´(ì¼ë°˜íšŒì› ë¡œê·¸ì¸)
![ê´€ë¦¬ìì•„ë‹Œë¡œê·¸ì¸](https://user-images.githubusercontent.com/65608960/112993642-6334c980-91a4-11eb-93c5-e9a27334f984.JPG)
![ê´€ë¦¬ìì•„ë‹Œë¡œê·¸ì¸2](https://user-images.githubusercontent.com/65608960/112993641-629c3300-91a4-11eb-8c13-664ed58b3924.JPG)


- íšŒì›ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì½”ë“œ(member_list)
    ```jsp
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%@ page import="java.sql.*"%>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%
        String id = null;
        
        // ì „ë‹¬ë°›ì€idê°’ì´ nullì´ê±°ë‚˜ adminì´ ì•„ë‹ˆë¼ë©´ 
        if((session.getAttribute("id") == null) ||
            (!((String)session.getAttribute("id")).equals("admin"))) {
            out.println("<script>");
            out.println("location.href='loginForm.jsp'"); // loginForm.jsp í˜ì´ì§€ë¡œ ì´ë™
            out.println("</script>");
        }
        
        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        
        try{
            Context init = new InitialContext();
            DataSource ds = (DataSource) init.lookup("java:/comp/env/jdbc/scott");
            con = ds.getConnection();
            pstmt=con.prepareStatement("SELECT * FROM member");
            rs=pstmt.executeQuery();
            
        }catch(Exception e){
            e.printStackTrace();
        }
    %>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>íšŒì›ê´€ë¦¬ ì‹œìŠ¤í…œ ê´€ë¦¬ìëª¨ë“œ(íšŒì› ëª©ë¡ ë³´ê¸°)</title>
    <style>
        table{
            margin : auto;
            width : 400px;
            border : 1px solid gray;
            text-align: center;
        }
        .td_title{
            font-weight: bold;
            font-size: x-large;
        }
    </style>
    </head>
    <body>
    <table>
        <tr><td colspan=2 class="td_title">íšŒì› ëª©ë¡</td></tr>
        <!-- member í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ” ë ˆì½”ë“œ ìˆ˜ ë§Œí¼ íšŒì› ì •ë³´ë¥¼ ì¶œë ¥ -->
        <%while(rs.next()){%> 
        <tr>
            <td>
                <!-- íšŒì›ì•„ì´ë”” í´ë¦­ì‹œ í•´ë‹¹ íšŒì›ì˜ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” member_info.jspí˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë§í¬ ìƒì„±
                    ì •ë³´ë¥¼ ë³´ì—¬ì¤„ íšŒì›ì„ íŒë‹¨í•˜ê¸° ìœ„í•´ idê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡í•œë‹¤ -->
                <a href="member_info.jsp?id=<%=rs.getString("id") %>">
                    <!-- íšŒì›ì˜ id ì»¬ëŸ¼ ê°’ì„ ì¶œë ¥ -->
                    <%=rs.getString("id") %> 
                </a>
            </td>
            <td>
                <!-- íšŒì›ì •ë³´ë¥¼ ì‚­ì œí•˜ëŠ” í˜ì´ì§€ì¸ member_delete.jsp í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë§í¬ ì„¤ì •,
                        ì‚­ì œí•  íšŒì› íŒë‹¨ìœ„í•´ idê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡ -->
                <a href="member_delete.jsp?id=<%=rs.getString("id") %>">ì‚­ì œ</a>
            </td>
        </tr>
        <%} %>
    </table>
    </body>
    </html>
    </html>
    ```
â–¶ ì¶œë ¥í™”ë©´(íšŒì› ëª©ë¡)
![íšŒì›ëª©ë¡](https://user-images.githubusercontent.com/65608960/112993632-60d26f80-91a4-11eb-9b16-d91718901c75.JPG)

- íšŒì› ì •ë³´ ì¡°íšŒ ì½”ë“œ(member_info)
    ```js
    m<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%@ page import="java.sql.*"%>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%
        String id = null;
        // ì…ë ¥ë°›ì€ idê°’ì´ nullì´ê±°ë‚˜ adminì´ ì•„ë‹ˆë¼ë©´
        if((session.getAttribute("id")==null) ||
            (!((String)session.getAttribute("id")).equals("admin"))){
            
            out.println("<script>");
            out.println("location.href='loginForm.jsp'"); // loginForm.jsp í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤
            out.println("</script>");
        }
        
        String info_id = request.getParameter("id");
        
        Connection conn=null;
        PreparedStatement pstmt=null;
        ResultSet rs=null;
        
        try {
                Context init = new InitialContext();
                DataSource ds = 
                    (DataSource) init.lookup("java:/comp/env/jdbc/scott");
                conn = ds.getConnection();
                
                pstmt=conn.prepareStatement("SELECT * FROM member WHERE id=?");
                pstmt.setString(1,info_id);
                rs=pstmt.executeQuery();
                rs.next();
        }catch(Exception e){
            e.printStackTrace();
        }
    %>
    <html lang="ko">
    <head>
    <meta charset="UTF-8">
    <title>íšŒì›ê´€ë¦¬ ì‹œìŠ¤í…œ ê´€ë¦¬ìëª¨ë“œ(íšŒì› ì •ë³´ ë³´ê¸°)</title>
    <style>
        table{
            margin : auto;
            width : 400px;
            border : 1px solid gray;
            text-align: center;
        }
    </style>
    </head>
    <body>
    <table>
        <tr>
            <td>ì•„ì´ë”” : </td>
            <td><%=rs.getString("id") %></td>
        </tr>
        <tr>
            <td>ë¹„ë°€ë²ˆí˜¸ : </td>
            <td><%=rs.getString("pass") %></td>
        </tr>
        <tr>
            <td>ì´ë¦„ : </td>
            <td><%=rs.getString("name") %></td>
        </tr>
        <tr>
            <td>ë‚˜ì´ : </td><td><%=rs.getString("age") %></td>
        </tr>
        <tr>
            <td>ì„±ë³„ : </td><td><%=rs.getString("gender") %></td>
        </tr>
        <tr>
            <td>ì´ë©”ì¼ ì£¼ì†Œ : </td>
            <td><%=rs.getString("email") %></td>
        </tr>
        <tr>
            <!-- íšŒì›ëª©ë¡ì„ ë³´ëŠ” í˜ì´ì§€ë¡œ ë§í¬ë¥¼ ìƒì„± -->
            <td colspan=2><a href="member_list.jsp">ë¦¬ìŠ¤íŠ¸ë¡œ ëŒì•„ê°€ê¸°</a></td>
        </tr>
    </table>
    </body>
    </html>
    ```

- íšŒì› ì‚­ì œ ì½”ë“œ(member_delete)
    ```js
    <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
    <%@ page import="java.sql.*"%>
    <%@ page import="javax.sql.*" %>
    <%@ page import="javax.naming.*" %>
    <%
        String id=null;
        
        
        if ((session.getAttribute("id")==null) || 
        (!((String)session.getAttribute("id")).equals("admin"))) {
            out.println("<script>");
            out.println("location.href='loginForm.jsp'");
            out.println("</script>");
        }
        
        String delete_id=request.getParameter("id");
        
        Connection con=null;
        PreparedStatement pstmt=null;
        ResultSet rs=null;
        
        try {
                Context init = new InitialContext();
                DataSource ds = 
                    (DataSource) init.lookup("java:/comp/env/jdbc/scott");
                con = ds.getConnection();
                
                pstmt=con.prepareStatement("DELETE FROM member WHERE id=?");
                pstmt.setString(1,delete_id);
                pstmt.executeUpdate();
                
                out.println("<script>");
                out.println("location.href='member_list.jsp'");
                out.println("</script>");
        }catch(Exception e){
            e.printStackTrace();
        }finally{
            try{
                pstmt.close();
                con.close();
            }
            catch(Exception e){
                e.printStackTrace();
            }
        }
    %>
    ```
â–¶ DB ì¶œë ¥í™”ë©´
![db](https://user-images.githubusercontent.com/65608960/112994347-1d2c3580-91a5-11eb-9057-e564f1cbdfde.JPG)
