---
layout: post
title: "JAVA -JDBC í”„ë¡œê·¸ë˜ë° - DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(paging,isEnableEmail(email/ id,email)) "
date: 2021-03-16
category : [JAVA]
comments: true
---

## ğŸ”·JDBC -  DAO ì‘ì„± ë° êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±(paging,isEnableEmail(email/ id,email))


- DAO êµ¬í˜„í´ë˜ìŠ¤ ì‘ì„±
    ```java
     package com.javateam.jdbc.member.dao.Impl;

    import java.sql.Connection;
    import java.sql.PreparedStatement;
    import java.sql.ResultSet;
    import java.sql.SQLException;

    import java.util.ArrayList;
    import java.util.List;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.domain.MemberVo;
    import com.javateam.jdbc.member.util.DbUtil;

    /**
    * MemberDaoì˜ êµ¬í˜„ í´ë˜ìŠ¤(concrete class)<br><br>
    * 
    *
    * ìš©ë¡€) MemberDao dao = MemberdaoImpl.getInstance();<br>
    * : ì‹±í´í„´(singleton:ë…ì‹ ì) íŒ¨í„´ ì ìš© &rarr; ë³´ì•ˆ<br><br>
    *  
    * @author mingki
    *
    */
    public class MemberDaoImpl implements MemberDao {
        
        /** DAO ê°ì²´ : ì‹±í´í„´(singleton) ìƒì„± íŒ¨í„´ ì ìš©*/
        private static MemberDaoImpl instance = null;
        private MemberDaoImpl() {}
        
        /**
        * ì‹±ê¸€í„´ ê°ì²´(DAO singleton object) ìƒì„± ë©”ì„œë“œ 
        * 
        * @return DAO ê°ì²´
        */
        public static final MemberDaoImpl getInstance() {
            // final : ì˜¤ë²„ë¼ì´ë“œ ê¸ˆì§€
            
            if(instance == null) {
                instance = new MemberDaoImpl();
            }
            return instance;
        }

        @Override
        public List<MemberVo> getMembersByPaging(int page, int limit) {

            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            List<MemberVo> members = new ArrayList<>();
            
            // ê°œë³„ íšŒì›ì •ë³´ ê°ì²´ ì„ ì–¸
            MemberVo member = null;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String methodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // ê²°ê³¼ì…‹ ê°ì²´
            ResultSet rs = null;
            
            // SQL êµ¬ë¬¸
            // 1)
    //		String sql = "SELECT * " + 
    //		 "FROM (SELECT ROWNUM, " + 
    //		 "             m.*, " + 
    //		 "             FLOOR((ROWNUM - 1) / ? + 1) page " + 
    //		 "      FROM (" + 
    //		 "             SELECT * FROM member " + 
    //		 "             ORDER BY member_id ASC " + 
    //		 "           ) m " + 
    //		 "      ) " + 
    //		 "WHERE page = ?";
    //		
            // 2) 
            StringBuilder sb = new StringBuilder();
            sb.append("SELECT * ") 
            .append("FROM (SELECT ROWNUM,") 
            .append("             m.*,") 
            .append("             FLOOR((ROWNUM - 1) / ? + 1) page ") 
            .append("      FROM ( ") 
            .append("             SELECT * FROM member ") 
            .append("             ORDER BY member_id ASC ") 
            .append("           ) m ") 
            .append("      ) ") 
            .append("WHERE page = ?");
            
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬
            try {
                // pstmt = con.prepareStatement(sql); // 1)
                pstmt = con.prepareStatement(sb.toString()); // 2)
                // ë‚´ê°€ ì‘ì„±í•œê²ƒ
    //			pstmt.setInt(1,page);
    //			pstmt.setInt(2,limit);
                
                pstmt.setInt(1, limit); // í•œ í˜ì´ì§€ë‹¹ ì¶œë ¥ ì¸ì› ìˆ˜ 
                pstmt.setInt(2, page); // í˜„ì¬ í˜ì´ì§€
                
                // SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„±
                rs = pstmt.executeQuery();
            
                while(rs.next()) {
                
                    member = new MemberVo(); 
                    
                    // SQL ê²°ê³¼ì…‹ -> VOì—  ì´ê´€ 				
                    member.setMemberId(rs.getString("member_Id"));
                    member.setMemberPassword(rs.getString("member_Password"));
                    member.setMemberNicname(rs.getString("member_Nickname"));
                    member.setMemberName(rs.getString("member_Name"));
                    member.setMemberGender(rs.getString("member_Gender").charAt(0)); // charë¡œ ë³€í™˜
                    member.setMemberEmail(rs.getString("member_Email"));
                    member.setMemberPhone(rs.getString("member_Phone"));
                    member.setMemberBirth(rs.getDate("member_Birth"));
                    member.setMemberZip(rs.getString("member_Zip"));
                    member.setMemberAddressBasic(rs.getString("member_Address_Basic"));
                    member.setMemberAddressDetail(rs.getString("member_Address_Detail"));
                    member.setMemberJoindate(rs.getDate("member_JoinDate"));
                    
                    // VO -> List ë¡œ ì´ê´€(add) : ê°œë³„ íšŒì›ì •ë³´ ì¶”ê°€
                    members.add(member);
                    
                }
                
            } catch (SQLException e) {
                System.out.println(methodName + " : " + e.getMessage());
                
                // ìì› ë°˜ë‚©
            }finally {
                DbUtil.close(con, pstmt, rs);
            }		
            // ë¦¬í„´(ë°˜í™˜)
            return members;
        }

        @Override
        public boolean isEnableEmail(String memberEmail) {

            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            boolean result = false;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String methodName = new Exception().getStackTrace()[0].getMethodName();
            
            // DB ì—°ê²°
            Connection con = DbUtil.connect();
            
            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;
            
            // ê²°ê³¼ì…‹ ê°ì²´ (DOL : select)
            ResultSet rs = null;
            
            // SQL êµ¬ë¬¸
            // ë‚´ê°€ ì‘ì„±í•œê±°
    //		String sql = "SELECT count(*) FROM member " + 
    //				"WHERE member_email = ? ";
            
            // 1) 
    //		String sql = "SELECT DECODE(count(*), 0, 'true', 1, 'false') as email_flag "
    //				+ "FROM member " 
    //				+ "WHERE member_email = ? ";
            
            // 2) 
            String sql = "SELECT count(*) FROM member " + 
            "WHERE member_email = ? ";
            
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬
            try {
                pstmt = con.prepareStatement(sql);
                pstmt.setString(1, memberEmail);
                // SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„±
                rs = pstmt.executeQuery();
                // SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬
                
                // 1)
    //			 if(rs.next()) {
    //				 // booleanìœ¼ë¡œ í˜•ë³€í™˜
    //				 // result = Boolean.valueOf(rs.getString(1)); //(O)
    //				 // result = new Boolean(rs.getString(1)); // (O)
    //				 result = new Boolean(rs.getString("email_flag"));
    //			 }
                // 2)
                if(rs.next()) {
                    result = rs.getInt(1) == 1 ? false : true;
                }
                
                // ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œ
    //			 while(rs.next()) {				 
    //				 result = rs.getBoolean(1)== false ? false:true;				 
    //			 }
                
            } catch (SQLException e) {
                
                System.out.println(methodName + " : " + e.getMessage());
                // ìì› ë°˜ë‚©
            }finally {
                DbUtil.close(con, pstmt, rs);
                
            }
            // ë¦¬í„´(ë°˜í™˜)
            return result;
        }

        @Override
        public boolean isEnableEmail(String memberId, String memberEmail) {
            // ë¦¬í„´(ë°˜í™˜ê°’) ì²˜ë¦¬
            boolean result = false;
            
            // ì‹¤í–‰ ë©”ì„œë“œëª…  
            String methodName = new Exception().getStackTrace()[0].getMethodName();

            // DB ì—°ê²°
            Connection con = DbUtil.connect();

            // SQL ì²˜ë¦¬ ê°ì²´
            PreparedStatement pstmt = null;

            // ê²°ê³¼ì…‹ ê°ì²´ (DOL : select)
            ResultSet rs = null;

            // SQL êµ¬ë¬¸
            // ë‚´ê°€ ì‘ì„±í•œê±°
            String sql = "SELECT count(*) FROM member " + 
                    "WHERE member_id != ? AND member_email = ? ";

    //		String sql = "SELECT DECODE(count(*), 0, 'true', 1, 'false') as email_flag "
    //		+ "FROM member " 
    //		+ "WHERE memberid != ? AND member_email = ? ";
    //		
            // SQL, ì¸ì (ì„ )ì²˜ë¦¬
            try {
                pstmt = con.prepareStatement(sql);
                pstmt.setString(1,memberId);
                pstmt.setString(2, memberEmail);

                // SQL ê²°ê³¼ì…‹ ê°ì²´ ìƒì„±
                rs = pstmt.executeQuery();
                
                // SQL ì‹¤í–‰, ì˜ˆì™¸ì²˜ë¦¬	
                if(rs.next()) {
                    result = rs.getInt(1) == 0 ? true : false;
                
                }else {
                    result = false;
                }
                
            } catch (SQLException e) {
                System.out.println(methodName + " : " + e.getMessage());
                // ìì› ë°˜ë‚©
            }finally {
                DbUtil.close(con, pstmt, rs);
                
            }

            // ë¦¬í„´(ë°˜í™˜)
            return result;
        }
	   
    ```

- getMemberByPaging í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤

    ```java
    package com.javateam.jdbc.member.test;

    import java.util.List;
    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    import com.javateam.jdbc.member.domain.MemberVo;

    /**
    * getMembersByPaging ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤<br>
    * : í˜ì´ì§• ë‹¨ìœ„ë¡œ ì „ì²´ íšŒì›ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸<br><br>
    * 
    * @author migki
    *
    */
    public class PagingTest {

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao= MemberDaoImpl.getInstance();
            
            // í˜ì´ì§•ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ê¸°ëŒ€ê°’
            
            // 1) íŠ¹ì • í˜ì´ì§€ ì…ë ¥ì‹œ ì¸ì›ìˆ˜ - í•œí˜ì´ì§€ë‹¹ ì¸ì›ìˆ˜ 10ëª… ì œí•œ
            // 2) ì²˜ìŒ/ë§ˆì§€ë§‰ ì¸ì› íšŒì› ì•„ì´ë”” ì •ë³´ë¡œ ì ê²€
            // ex) 1 í˜ì´ì§€ ì²« ì•„ì´ë”” = goodee_1001, ë§ˆì§€ë§‰ ì•„ì´ë”” = goodee_1010
            
            List<MemberVo> members = dao.getMembersByPaging(1, 10);
            
            // 1) íŠ¹ì • í˜ì´ì§€ ì…ë ¥ì‹œ ì¸ì›ìˆ˜ - í•œí˜ì´ì§€ë‹¹ ì¸ì›ìˆ˜ 10ëª… ì œí•œ
            System.out.println("íŠ¹ì • í˜ì´ì§€ ì…ë ¥ì‹œ ì¸ì›ìˆ˜ : " + members.size());
            
            // 2) ì²˜ìŒ/ë§ˆì§€ë§‰ ì¸ì› íšŒì› ì•„ì´ë”” ì •ë³´ë¡œ ì ê²€
            // ex) 1 í˜ì´ì§€ ì²« ì•„ì´ë”” = goodee_1001, ë§ˆì§€ë§‰ ì•„ì´ë”” = goodee_1010
            System.out.println("ì²˜ìŒ ì¸ì› íšŒì› ì•„ì´ë”” ì •ë³´ë¡œ ì ê²€  : " + members.get(0).getMemberId().equals("goodee_1001"));
            System.out.println("ë§ˆì§€ë§‰ ì¸ì› íšŒì› ì•„ì´ë”” ì •ë³´ë¡œ ì ê²€  : " + members.get(9).getMemberId().equals("goodee_1010"));
            
            // íŠ¹ì • í˜ì´ì§€ ì „ì²´ ì¸ì› ì¶œë ¥
            for(MemberVo m : members) {
                System.out.println(m);
            }
                    
            // ë‚´ê°€ ì‘ì„±í•œì½”ë“œ 
            //System.out.println(dao.getMembersByPaging(1,10 ));		
        }
     }
    ```
â–¶ ì¶œë ¥ í™”ë©´ 
![paging](https://user-images.githubusercontent.com/65608960/111273908-b4f33500-8677-11eb-84d9-a9a4951413c7.JPG)


- isEnableEmail(memberEmail) í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
   package com.javateam.jdbc.member.test;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;

    /**
    * isEnableEmail ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤<br>
    * : ì´ë©”ì¼ ì¤‘ë³µ ì ê²€ í…ŒìŠ¤íŠ¸<br><br>
    * 
    * @author migki
    *
    */
    public class isEnableEmailTest {

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao = MemberDaoImpl.getInstance();
            
            // ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì™€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ ë‘ê°€ì§€ ê²½ìš°ë¥¼ í…ŒìŠ¤íŠ¸
            // 1) DB í˜„í™©ì— ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ ë¡œ ì ê²€
            System.out.println("íšŒì› ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€(goodee_1@abcd.com): " + dao.isEnableEmail("goodee_1@abcd.com"));
            
            // 2) DB í˜„í™©ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼  ì ê²€
            System.out.println("íšŒì› ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€(1234) : " + dao.isEnableEmail("1234"));

        }

    }
    ```

â–¶ ì¶œë ¥ í™”ë©´ 
![enablemail](https://user-images.githubusercontent.com/65608960/111274105-f08dff00-8677-11eb-98da-1122c7726ca8.JPG)

ğŸˆ ì¡´ì¬í•˜ëŠ”ê²½ìš° falseê°€ ì¶œë ¥ë˜ë„ë¡ í•œ ì´ìœ  : ì¤‘ë³µëœ ì´ë©”ì¼ì´ë¯€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸

- isEnableEmail(memberId, memberEmail) í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ```java
   package com.javateam.jdbc.member.test;

    import com.javateam.jdbc.member.dao.MemberDao;
    import com.javateam.jdbc.member.dao.Impl.MemberDaoImpl;
    /**
    * isEnableEmail(id, email) ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤<br>
    * : ì´ë©”ì¼ ì¤‘ë³µ ì ê²€ í…ŒìŠ¤íŠ¸<br><br>
    * 
    * @author migki
    *
    */
    public class isEnableEmailTest2 {

        public static void main(String[] args) {
            
            // DAO ê°ì²´ ìƒì„±
            MemberDao dao = MemberDaoImpl.getInstance();
            
            System.out.println("íšŒì› ID ì¡´ì¬, ë³¸ì¸ì˜ Email ì¡´ì¬ : " + dao.isEnableEmail("hyun", "skfksnsk1@gmail.com"));
            System.out.println("íšŒì› ID ì¡´ì¬, Email ì¡´ì¬X : " + dao.isEnableEmail("hyun", "skfksn@gmail.com"));
            System.out.println("íšŒì› ID ì¡´ì¬, ë‹¤ë¥¸íšŒì› mail ì¡´ì¬: " + dao.isEnableEmail("hyun", "goodee_2@abcd.com"));
        }
    }
    ```

â–¶ ì¶œë ¥ í™”ë©´ 
![enablemail2](https://user-images.githubusercontent.com/65608960/111278865-66489980-867d-11eb-9a18-d8465b49db62.JPG)
