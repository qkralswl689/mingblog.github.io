---
layout: post
title: "JAVA-ì´ê²ƒì´ ìë°”ë‹¤ : TCP ë„¤íŠ¸ì›Œí‚¹(1),"
date: 2021-03-09
category : [JAVA]
comments: true
---

# ğŸ”¶ 

## âœ” TCP ë„¤íŠ¸ì›Œí‚¹(1)

ğŸ’¡ ì„œë²„ ì™€ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°í•˜ê¸°

- ì„œë²„ ì½”ë“œ
    ```java
    package ThisJavaRead;

    import java.io.IOException;
    import java.io.InputStream;
    import java.io.OutputStream;
    import java.net.InetSocketAddress;
    import java.net.ServerSocket;
    import java.net.Socket;

    public class SeverSoket {
        public static void main(String[] args)  {
            
            // 1) ì„œë²„ ì†Œì¼“ë³€ìˆ˜ ì„ ì–¸
            ServerSocket serverSocket = null;
            
            // 2) ì„œë²„ ì†Œì¼“ ê°ì²´ ìƒì„± => ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•œë‹¤
            try {
                serverSocket = new ServerSocket();
                
                // 3) í¬íŠ¸ì™€ ë°”ì¸ë“œ => í˜„ì¬ ì»´í“¨í„°ì˜ 5001 ë²ˆì— ë°”ì¸ë”© í•œë‹¤ëŠ” ëœ»
                serverSocket.bind(new InetSocketAddress("localhost",5001));
                
                // 4) ë¬´í•œë£¨í”„ => ì„œë²„ëŠ” í•­ìƒ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ê¸°ë‹¤ë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì—
                while(true) {
                    System.out.println("[ì—°ê²° ê¸°ë‹¤ë¦¼]");
                    
                    // 5) í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìš”ì²­ ìˆ˜ë½ => í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ìš”ì²­ í•˜ê¸° ì „ê¹Œì§€ëŠ” ëŒ€ê¸°ìƒíƒœ
                    // í´ë¼ë¦¬ì–¸íŠ¸ë¡œë¶€í„° ì—°ê²°ìš”ì²­ì´ ì™”ì„ ë•Œ acceptëŠ” soketì´ë¼ëŠ” í†µì‹ ìš© ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë¦¬í„´í•œë‹¤
                    Socket socket = serverSocket.accept();
                    // Socket ì„ ê°€ì§€ê³  í´ë¼ì´ì–¸íŠ¸ì˜ ì •ë³´ë¥¼ ì–»ì–´ ë‚´ê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ì™€ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë‹¤
                                    
                    // 6) í´ë¼ì´ì–¸íŠ¸ì˜ ì•„ì´í”¼ ì¶œë ¥í•˜ê¸°
                    //(InetSocketAddress) : íƒ€ì…ë³€í™˜ => getRemoteSocketAddress ê°€ SocketAddressë¥¼ 
                    // ë¦¬í„´í•˜ê¸°ë•Œë¬¸ì— InetSocketAddress ìœ¼ë¡œ íƒ€ì…ë³€í™˜ í•´ì¤€ë‹¤
                    InetSocketAddress isa = (InetSocketAddress) socket.getRemoteSocketAddress();
                    System.out.println("[ì—°ê²° ìˆ˜ë½í•¨]" + isa.getHostName());
                    
                    // 8) ë°›ì€ ë°ì´í„° ì €ì¥í•  byteë°°ì—´ ìƒì„±
                    byte[] bytes =null;
                    
                    // 9) ë¬¸ìì—´ë¡œ ë³€í™˜í•´ì„œ ì €ì¥í•  ë³€ìˆ˜ ì„ ì–¸
                    String message = null;
                    
                    // 10) í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ ë°ì´í„° ë°›ê¸°
                    InputStream is = socket.getInputStream();
                    
                    // 11) ê¸¸ì´ 100 ì§œë¦¬ byte ë°°ì—´ìƒì„±
                    bytes = new byte[100];
                    
                    // 12) ë°ì´í„° ì½ê¸°
                    // is.read() : input streamìœ¼ë¡œë¶€í„° readë©”ì†Œë“œ ë¶ˆëŸ¬ì˜¤ê¸°
                    // is.read(bytes) : ë§¤ê°œê°’ => ë°”ì´íŠ¸ë°°ì—´
                    // read() : í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸° ì „ ê¹Œì§€ëŠ” ëŒ€ê¸° ìƒíƒœì´ë‹¤
                    // í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ ë³´ë‚´ê²Œ ë˜ë©´ ë°°ê°œê°’(bytes)ì— ì €ì¥ë˜ê³ 
                    // ì‹¤ì œë¡œ ì½ì€ ë°”ì´íŠ¸ ìˆ˜ëŠ” ë³€ìˆ˜ (readByteCount) ì— ì €ì¥ëœë‹¤
                    int readByteCount = is.read(bytes);
                    
                    // 13) ë¬¸ìì—´ë¡œ ë³€í™˜ => 1ë²ˆ ë°”ì´íŠ¸ ìˆ˜ë§Œí¼ ë³€í™˜,í´ë¼ì´ì–¸íŠ¸ê°€ utf-8ë¡œ ë°”ì´íŠ¸ ë°°ì—´ì„ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— utf-8ë¡œ ë³µì›
                    message = new String(bytes,0,readByteCount, "UTF-8");
                    System.out.println("[ë°ì´í„° ë°›ê¸° ì„±ê³µ]" + message );
                    
                    // 14) ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„° ë³´ë‚´ê¸°
                    
                    // ì†Œì¼“ìœ¼ë¡œë¶€í„° ì•„ì›ƒí’‹ìŠ¤íŠ¸ë¦¼ ì–»ê¸°
                    OutputStream os = socket.getOutputStream();
                    
                    // ë³´ë‚¼ ë©”ì„¸ì§€ ì‘ì„±
                    message = "Hello Client";
                    
                    // ë©”ì„¸ì§€ë¡œ ë¶€í„° ë°”ì´íŠ¸ ë°°ì—´ ì–»ê¸°
                    bytes = message.getBytes("UTF-8");
                    
                    // ì•„ì›ƒí’‹ìŠ¤íŠ¸ë¦¼ ì´ìš©í•´ ë°”ì´íŠ¸ ë°°ì—´ ì¶œë ¥
                    os.write(bytes);
                    os.flush();
                    System.out.println("[ë°ì´í„° ë³´ë‚´ê¸° ì„±ê³µ]");
                    
                    // 15) I/O ì‚¬ìš© ì•ˆí•˜ê¸° ë•Œë¬¸ì— ì „ë¶€ ë‹«ì•„ì£¼ê¸° 
                    is.close();
                    os.close();
                    socket.close(); // ì†Œì¼“ì„ ë‹«ëŠ”ê²ƒ => ì—°ê²° ëŠê¸°
                    
                    
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
            
            // 7) ì„œë²„ ì†Œì¼“ ë‹«ê¸°
            // ë§Œì•½ì— ì„œë²„ì†Œì¼“ì´ í˜„ì¬ ë‹«í˜€ìˆì§€ ì•Šë‹¤ë©´
            if(!serverSocket.isClosed()) {
                // ì„œë²„ì†Œì¼“ì„ ë‹«ì•„ì¤€ë‹¤ , ì˜ˆì™¸ì²˜ë¦¬
                try {
                    serverSocket.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }

    }
    ```
â–¶ ì„œë²„ì‹¤í–‰ì‹œ ì¶œë ¥ ì½˜ì†”
![server1](https://user-images.githubusercontent.com/65608960/110439493-e1003a80-80fa-11eb-8562-29ac21afe76f.JPG)

â–¶ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°í›„ ì¶œë ¥ ì½˜ì†”
![server2](https://user-images.githubusercontent.com/65608960/110439487-e067a400-80fa-11eb-8f7a-3942cb31bdc6.JPG)


- í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ

    ```java
    package ThisJavaRead;

    import java.io.IOException;
    import java.io.InputStream;
    import java.io.OutputStream;
    import java.net.InetSocketAddress;
    import java.net.Socket;

    public class Client {

        public static void main(String[] args) {
            
            
            // 1) ì†Œì¼“ ë³€ìˆ˜ ì„ ì–¸
            Socket socket = null;
            
            // 2) ì†Œì¼“ ê°ì²´ ìƒì„± => ì„œë²„ì— ì—°ê²°ìš”ì²­í•˜ê¸° ìœ„í•´		
            socket = new Socket();
            
            // 3) ì—°ê²°í•˜ê¸° , ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”
            System.out.println("[ì—°ê²° ìš”ì²­]");
            try {
                // ("localhost",5001) : ì„œë²„ì˜ ip, í¬íŠ¸ë²ˆí˜¸
                socket.connect(new InetSocketAddress("localhost",5001));
                System.out.println("[ì—°ê²° ì„±ê³µ]");
                
                // 4) ì„œë²„ë¡œ ë°ì´í„° ë³´ë‚¼ ì½”ë“œ ì‘ì„±
                byte[] bytes = null; // ë°”ì´íŠ¸ ë°°ì—´ì„ ì–¸
                String message = null; // ë¬¸ìì—´ë¡œ ë³€í™˜í•´ ì €ì¥í•  ë³€ìˆ˜ ì„ ì–¸
                
                // ì†Œì¼“ìœ¼ë¡œë¶€í„° ì•„ì›ƒí’‹ ìŠ¤íŠ¸ë¦¼ì„ ì–»ì–´ë‚¸ë‹¤
                OutputStream os = socket.getOutputStream();
                
                // ìŠ¤íŠ¸ë§ ë³€ìˆ˜ messageì— ë¬¸ìì—´ í• ë‹¹
                message = "Hello Server";
                
                // messageë¡œ ë¶€í„° ë°”ì´íŠ¸ ë°°ì—´ ì–»ê¸°
                bytes = message.getBytes("UTF-8");
                
                // 5) output Stream í†µí•´ ë°ì´í„° ì „ë‹¬(toì„œë²„)
                os.write(bytes);
                os.flush();
                System.out.println("[ë°ì´í„° ë³´ë‚´ê¸° ì„±ê³µ]");
                
                // 6) ì„œë²„ë¡œ ë¶€í„° ë°ì´í„° ë°›ê¸°
                InputStream is = socket.getInputStream();
                
                // ê¸¸ì´ 100ì§œë¦¬ ë°”ì´íŠ¸ ë°°ì—´ ìƒì„±
                bytes = new byte[100];
                
                // input Stream ìœ¼ë¡œë¶€í„° readë©”ì†Œë“œ í˜¸ì¶œí•´ ë°”ì´íŠ¸ë°°ì—´ ì½ê¸°
                int readByteCount = is.read(bytes);
                
                // ì½ì€ ë°”ì´íŠ¸ ë°°ì—´ ë¬¸ìì—´ë¡œ ë³€í™˜
                // bytes ë°°ì—´ ì˜ 0ë²ˆ ì¸ë±ìŠ¤ë¶€í„° ì½ì€ ë°”ì´íŠ¸ ìˆ˜ë§Œí¼ ë¬¸ìì—´ë¡œ ë³€í™˜
                message = new String(bytes,0,readByteCount,"UTF-8");
                System.out.println("[ë°ì´í„° ë°›ê¸° ì„±ê³µ] : " + message);
                
                os.close();
                is.close();
                // socketì€ ì•„ë˜ ì˜ˆì™¸ì²˜ë¦¬ì—ì„œ ë‹«ì•„ì£¼ê¸°ë•Œë¬¸ì— ë”°ë¡œ ë‹«ëŠ” ëª…ë ¹ì–´ ì‘ì„± X
                
            } catch (Exception e) {
                e.printStackTrace();
            }
            if(!socket.isClosed()) {
                try {
                    socket.close();
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }
            }
        }

    }
    ```
â–¶ í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ì‹œ ì¶œë ¥ì½˜ì†”
![client](https://user-images.githubusercontent.com/65608960/110439495-e198d100-80fa-11eb-97a2-f8e748fb8ed9.JPG)
