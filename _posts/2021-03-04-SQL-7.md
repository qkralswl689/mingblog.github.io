---
layout: post
title: "DB -SQL ì„œë¸Œì¿¼ë¦¬(ì¤‘ì²©ì¿¼ë¦¬)ì¡°ì¸"
date: 2021-03-04
category : [DB]
comments: true
---

## ğŸ”·ì„œë¸Œì¿¼ë¦¬(ì¤‘ì²©ì¿¼ë¦¬)ì¡°ì¸ ì‹¤ìŠµ

### âœ” ì¤‘ì²©ì¿¼ë¦¬(ì„œë¸Œì¿¼ë¦¬)

    - ì„œë¸Œì¿¼ë¦¬ : ì¿¼ë¦¬ì•ˆì— ì¡´ì¬í•˜ëŠ” ë˜ë‹¤ë¥¸ ì¿¼ë¦¬

- ì½”ë“œ
    ```sql
    -- 1. ë¶€ì„œê°€ "Finance"ì¸ ì‚¬ì› ì¤‘ì—ì„œ ìµœê³  ê¸‰ì—¬ë¥¼ ë°›ëŠ” ì‚¬ì›(ë“¤)ì˜ ì´ë¦„ê³¼ ê¸‰ì—¬ë¥¼ ì¶œë ¥í•˜ì‹­ì‹œì˜¤.

    -- first_name ê³¼ last_name ê°€ìš´ë°ì— ê³µë°±ì„ ë‘ê³  ì—°ê²°í•˜ê³  ì‚¬ì›ëª… ì´ë¼ëŠ” ë³„ì¹­, salaryë¥¼ ê¸‰ì—¬ ë¼ëŠ” ë³„ì¹­ìœ¼ë¡œ ì¶œë ¥í•´ë¼
    select (first_name||' '||last_name) "ì‚¬ì›ëª…" ,salary "ê¸‰ì—¬"
    -- employees í…Œì´ë¸”ë¡œë¶€í„°
    from employees
    -- department_id ëŠ” 
    -- department_name ì´ 'Finance' ì¸ 
    -- departments í…Œì´ë¸”ì—ì„œ
    -- department_id ì„ íƒí•˜ê³  ì´ ìë£Œì™€ employees í…Œì´ë¸”ì—ì„œì˜ department_id ìë£Œê°€ ì¼ì¹˜í•˜ëŠ”ê²ƒì„ ì„ íƒ
    where department_id = (select department_id 
                        from departments
                        where department_name = 'Finance')
    -- ê·¸ë¦¬ê³  salaryëŠ” 
    -- department_name ì´ 'Finance' ì¸
    -- departments í…Œì´ë¸”ì—ì„œ
    --  department_id ì„ íƒí•˜ê³   employees í…Œì´ë¸”ì—ì„œì˜ department_id ìë£Œê°€ ì¼ì¹˜í•˜ëŠ”ê²ƒ ì¤‘ì—
    -- max(salary) ì¸ ìë£Œì™€ employees í…Œì´ë¸”ì— salary ì¤‘ ì¼ì¹˜í•˜ëŠ”ê²ƒì„ ì„ íƒ
    and salary = (select max(salary)
                from employees
                where department_id =(select department_id
                                        from departments
                                        where department_name = 'Finance'));
                                        
    -- 2. ì˜¥ìŠ¤í¬ë“œ(Oxford) ì‹œì— ê±°ì£¼í•˜ëŠ” ì§ì›ì˜ ì´ë¦„ì„ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì¶œë ¥í•˜ì‹­ì‹œì˜¤. 
    -- first_name ì™€ last_name ì‚¬ì´ì— ê³µë°±ì„ ë‘ê³  ì¶œë ¥í•œë‹¤
    select first_name||' '||last_name
    -- employees í…Œì´ë¸”ë¡œë¶€í„°
    from employees
    -- department_idëŠ” 
    -- d.location_id ì™€ l.location_id  ì´ ê°™ê³  l.city ê°€ 'Oxford' ì¸ ìë£Œì˜
    -- d.department_id ë¥¼ ì…€ë ‰íŠ¸í•œë‹¤ 
    -- departments d, locations l í…Œì´ë¸”ë¡œë¶€í„°
    -- ìœ„ì—ì„œ ì¶”ì¶œëœ ìë£Œê°€ department_id  ì™€ ê°™ìœ¼ë©´ 
    where department_id = (select d.department_id
                        from departments d, locations l
                        where d.location_id = l.location_id
                        and l.city = 'Oxford')
    -- first_name ì˜¤ë¦„ì°¨ìˆœ ìœ¼ë¡œ ì •ë ¬í•œë‹¤                     
    order by first_name;                       
                    
    -- 2ë²ˆ ì„œë¸Œì¿¼ë¦¬ ì‚¬ìš© ì•ˆí•œ ê²ƒ
    SELECT e.first_name ||' '|| e.last_name
    from employees e, departments d, locations l
    where e.department_id = d.department_id
    and d.location_id = l.location_id
    and l.city = 'Oxford'
    order by first_name;

    -- 3. í‡´ì§ì¼ê³¼ ê´€ê³„ì—†ì´ 2002ë…„ 1ì›” 1ì¼ ì´ì „ì— ê·¼ë¬´í•˜ê¸° ì‹œì‘í•œ ì‚¬ëŒë“¤ì˜ ì•„ì´ë””ì™€ ì´ë¦„(ì„±í•¨ì„ í•©ì³ì„œ ì¶œë ¥í•¨)
    -- ì„ í™”ë©´ì— ì¸ì‡„í•˜ì‹­ì‹œì˜¤ , ë‹¨, hr ê³„ì •ì— ìˆëŠ” í…Œì´ë¸”ì—ì„œ ì‘ì„±í•˜ë˜ 
    -- ì‘ì„±ì‹œ ë™ë“± ì¡°ì¸(equi-join) ë° ì„œë¸Œì¿¼ë¦¬(sub query)ì„ ì´ìš©í•˜ì—¬ ê°ê° ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.

    -- (ë™ë“±ì¡°ì¸) ë‚´ê°€ í‘¼ê²ƒ
    select e.employee_id ,e.first_name ||' '|| e.last_name
    from employees e, job_history j
    where e.employee_id = j.employee_id
    and j.start_date > '02/01/01';

    -- ë‹µ
    -- ì¤‘ë³µ ë°°ì œ í•˜ê¸°ìœ„í•´ distinct ì‚¬ìš©
    SELECT DISTINCT e.employee_id,
    -- ë³„ì¹­ ì‚¬ìš©
                    (e.first_name || ' ' || e.last_name) AS "ì´ë¦„"
    FROM employees e, job_history j
    WHERE e.employee_id = j.employee_id
    -- 2002/01/01 ì´ì „ì´ê¸°ë•Œë¬¸ì— ë¶€ë“±í˜¸ < ì‚¬ìš©
    AND  j.start_date < '2002/01/01';   

    -- (ì„œë¸Œì¿¼ë¦¬) ë‚´ê°€í‘¼ê²ƒ
    select employee_id ,first_name ||' '|| last_name
    from employees 
    where employee_id = (select employee_id
                        from job_history
                        where start_date > '20/01/01');

    -- ë‹µ  
    SELECT DISTINCT e.employee_id,
                (e.first_name || ' ' || e.last_name) AS "ì´ë¦„"
    FROM employees e
    -- ì—¬ëŸ¬ì¡°ê±´ì´ ê²€ìƒ‰ë˜ë¯€ë¡œ in ì‚¬ìš©
    WHERE e.employee_id IN ( SELECT j.employee_id
                            FROM job_history j
                            WHERE j.start_date < '2002/01/01' ); 

    -- 4. 2005ë…„ 4ì›” 1ì¼ ë‹¹ì¼ì— ê·¼ë¬´ì¤‘ì´ì—ˆìœ¼ë©°,   
    --  ë¯¸êµ­ ì‹œì• í‹€(Seattle)ì— ìœ„ì¹˜í•œ ë¶€ì„œì—ì„œ ê·¼ë¬´í–ˆë˜ ê·¼ë¡œìë“¤ì˜ ì´ë¦„ì„ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì¶œë ¥í•˜ë„ë¡ ì¡°ì¹˜í•˜ì‹­ì‹œì˜¤.
    -- ì¤‘ì²© ì¿¼ë¦¬(inner query)ë¥¼ ì‚¬ìš©í•˜ì—¬ í’€ì´í•˜ë„ë¡ í•©ë‹ˆë‹¤.

    -- ë‚´ê°€í‘¼ê²ƒ
    select employee_id,first_name||' '||last_name "ì´ë¦„"
    from employees 
    where employee_id in(select employee_id
                        from job_history j
                        where(start_date <= '2005/04/01'
                        and end_date >= '2005/04/01')                     
    and j.department_id in(select d.department_id
                        from departments d
                        where d.location_id =(select location_id
                                                from locations
                                                where city = 'Seattle'))
                        )                 
    order by first_name ;                                            

    --  ë‹µ1)
    -- employee_id ì™€ first_nameì™€ last_nameì„ ê³µë°±ì„ ë‘ê³  ì—°ê²°í•˜ê³  "ì´ë¦„" ì´ë¼ëŠ” ë³„ì¹­ìœ¼ë¡œ ì¶œë ¥í•œë‹¤
    select employee_id,first_name||' '||last_name "ì´ë¦„"
    -- employees e í…Œì´ë¸”ë¡œë¶€í„°
    from employees e
    -- ì²«ë²ˆì§¸ ì„œë¸Œì¿¼ë¦¬
    -- job_history j í…Œì´ë¸”ì— ìˆëŠ” j.department_id ì—ì„œ employee_id ê°€
    -- employee_id ì™€ ê°™ì€ê²ƒ
    -- ë‘ë²ˆì§¸ ì„œë¸Œì¿¼ë¦¬
    -- job_history í…Œì´ë¸”ì—ì„œ department_id ì¤‘ì— start_date ê°€ '2005/04/01' ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ê³ 
    -- end_date ê°€ '2005/04/01' ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ë°ì´í„°
    -- ì„¸ë²ˆì§¸ ì„œë¸Œì¿¼ë¦¬ : ì²«ë²ˆì§¸ ì„œë¸Œ ì¿¼ë¦¬ì—ì„œ and ì¡°ê±´
    -- departments d í…Œì´ë¸”ì—ì„œ department_id ì¤‘ì— d.location_id ë¥¼ ê°€ì§„ê²ƒ
    -- ë„¤ë²ˆì§¸ ì„œë¸Œì¿¼ë¦¬ 
    -- locations í…Œì´ë¸”ì—ì„œ city ê°€ 'Seattle' ì¸ location_id ë°ì´í„° 

    where employee_id in (select employee_id 
                        FROM job_history j
                        where j.department_id in(select department_id 
                                                    FROM job_history
                                                    WHERE start_date <= '2005/04/01'
                                                    and end_date >= '2005/04/01')
                        and department_id in(select department_id
                                            from departments d
                                            where d.location_id in(select location_id
                                                                    from locations
                                                                    where city = 'Seattle')
                    )
                    )
    ORDER BY "ì´ë¦„";                                                                  

    -- ë‹µ2) 
    SELECT employee_id, first_name ||' '|| last_name "ì´ë¦„"
    FROM employees e
    WHERE employee_id IN (SELECT j.employee_id
                        FROM job_history j
                        WHERE (j.start_date < '2005/04/01'
                        AND j.end_date > '2005/04/01')               
    AND j.department_id IN (SELECT d.department_id
                            FROM departments d
                            WHERE d.location_id = (SELECT l.location_id
                                                FROM locations l
                                                WHERE l.city = 'Seattle'))
                            )
    ORDER BY "ì´ë¦„";
    ```
